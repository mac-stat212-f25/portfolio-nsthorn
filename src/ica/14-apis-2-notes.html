<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>14 APIs P2 ‚Äì COMP/STAT212 Portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../src/ica/15-scraping-notes.html" rel="next">
<link href="../../src/ica/12-iteration-2-notes.html" rel="prev">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-b6165e882820e9cbe81d0573c00a9ad9.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-336fc07c9e36db0483797e7526239151.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-b6165e882820e9cbe81d0573c00a9ad9.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="../../style/custom.css">
</head>

<body class="nav-sidebar docked quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../src/ica/cleaning.html">In-Class Activities</a></li><li class="breadcrumb-item"><a href="../../src/ica/14-apis-2-notes.html"><span class="chapter-title">14 APIs P2</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../assets/sidebar-logo.png" alt="Random negative space illustration" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Nico Thorn</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Prof Viz</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/pv/pv-01.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Professional Viz</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">TidyTuesday</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/tt/hw01-tt.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Homework 01</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/tt/2025-07-08.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">TidyTuesday Sample 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/tt/2025-07-15.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">TidyTuesday Sample 2</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">In-Class Activities</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/cleaning.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Cleaning SFO Weather Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/03-adv-ggplot-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3 Advanced Data Viz</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/04-adv-maps-1-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4 Advanced Spatial Viz P1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/06-wrangling-1-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">6 Adv Data wrangling P1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/07-wrangling-2-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">7 Adv Data wrangling P2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/08-missing-data-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">8 Missing Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/09-functions-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">9 Functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/10-base-r-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">10 Base R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/11-iteration-1-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">11 Loops+Iter P1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/12-iteration-2-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">12 Loops+Iter P2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/14-apis-2-notes.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">14 APIs P2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/15-scraping-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">15 Web scraping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/16-databases-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">16 Databases and SQL</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/18-interactive-viz-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">18 Interactive Viz</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/appx/appx-sample1.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix Sample 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/appx/appx-sample2.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix Sample 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mm/mm.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Mind Maps</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-goals" id="toc-learning-goals" class="nav-link active" data-scroll-target="#learning-goals">üß© Learning Goals</a></li>
  <li><a href="#apis" id="toc-apis" class="nav-link" data-scroll-target="#apis">APIs</a></li>
  <li><a href="#web-apis" id="toc-web-apis" class="nav-link" data-scroll-target="#web-apis">Web APIs</a>
  <ul class="collapse">
  <li><a href="#url" id="toc-url" class="nav-link" data-scroll-target="#url">URL</a></li>
  <li><a href="#example-web-apis" id="toc-example-web-apis" class="nav-link" data-scroll-target="#example-web-apis">Example Web API‚Äôs</a></li>
  </ul></li>
  <li><a href="#wrapper-packages" id="toc-wrapper-packages" class="nav-link" data-scroll-target="#wrapper-packages">Wrapper packages</a></li>
  <li><a href="#accessing-web-apis-directly" id="toc-accessing-web-apis-directly" class="nav-link" data-scroll-target="#accessing-web-apis-directly">Accessing web APIs directly</a>
  <ul class="collapse">
  <li><a href="#getting-a-census-api-key" id="toc-getting-a-census-api-key" class="nav-link" data-scroll-target="#getting-a-census-api-key">Getting a Census API key</a></li>
  <li><a href="#navigating-api-documentation" id="toc-navigating-api-documentation" class="nav-link" data-scroll-target="#navigating-api-documentation">Navigating API documentation</a></li>
  <li><a href="#building-a-url-with-httr2" id="toc-building-a-url-with-httr2" class="nav-link" data-scroll-target="#building-a-url-with-httr2">Building a URL with <code>httr2</code></a></li>
  <li><a href="#sending-a-request-with-httr2" id="toc-sending-a-request-with-httr2" class="nav-link" data-scroll-target="#sending-a-request-with-httr2">Sending a request with <code class="unnumbered">httr2</code></a></li>
  <li><a href="#getting-a-response-with-httr2" id="toc-getting-a-response-with-httr2" class="nav-link" data-scroll-target="#getting-a-response-with-httr2">Getting a response with <code>httr2</code></a></li>
  </ul></li>
  <li><a href="#more-api-examples" id="toc-more-api-examples" class="nav-link" data-scroll-target="#more-api-examples">More API Examples</a>
  <ul class="collapse">
  <li><a href="#board-game-geek-xml-data" id="toc-board-game-geek-xml-data" class="nav-link" data-scroll-target="#board-game-geek-xml-data">Board Game Geek &amp; XML Data</a></li>
  <li><a href="#new-york-times-api" id="toc-new-york-times-api" class="nav-link" data-scroll-target="#new-york-times-api">New York Times API</a></li>
  </ul></li>
  <li><a href="#done" id="toc-done" class="nav-link" data-scroll-target="#done">Done!</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../src/ica/cleaning.html">In-Class Activities</a></li><li class="breadcrumb-item"><a href="../../src/ica/14-apis-2-notes.html"><span class="chapter-title">14 APIs P2</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-title">14 APIs P2</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<section id="learning-goals" class="level2">
<h2 class="anchored" data-anchor-id="learning-goals">üß© Learning Goals</h2>
<p>By the end of this lesson, you should be able to: - Explain what an API is - Set up an API key for a public API - Develop comfort in using a URL-method of calling a web API - Recognize the structure in a URL for a web API and adjust for your purposes - Explore and subset complex nested lists</p>
</section>
<section id="apis" class="level2">
<h2 class="anchored" data-anchor-id="apis">APIs</h2>
<p>An <strong>API</strong> stands for <strong>Application Programming Interface</strong>, and this term describes a general class of tools that allows computer software, rather than humans, to interact with an organization‚Äôs data.</p>
<ul>
<li><em>Application</em> refers to software.</li>
<li><em>Interface</em> can be thought of as a contract of service between two applications. This contract defines how the two communicate with each other using requests and responses.</li>
</ul>
<p>Every API has documentation for how software developers should structure requests for data / information and in what format to expect responses.</p>
</section>
<section id="web-apis" class="level2">
<h2 class="anchored" data-anchor-id="web-apis">Web APIs</h2>
<p><a href="https://en.wikipedia.org/wiki/Web_API">Web APIs</a>, or Web Application Programming Interfaces, which focus on transmitting requests and responses for raw data through a web browser.</p>
<ul>
<li>Our browsers communicate with web servers using a technology called <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTP</a> or Hypertext Transfer Protocol.</li>
<li>Programming languages such as R can also use HTTP to communicate with web servers.</li>
</ul>
<section id="url" class="level3">
<h3 class="anchored" data-anchor-id="url">URL</h3>
<p>Every document on the Web has a unique address. This address is known as Uniform Resource Locator (URL).</p>
<p>Every URL has the same general structure. Let‚Äôs look at this example:</p>
<p><code>https://api.census.gov/data/2019/acs/acs1?get=NAME,B02015_009E,B02015_009M&amp;for=state:*</code></p>
<ul>
<li><code>https://api.census.gov</code>: This is the <strong>base URL</strong>.
<ul>
<li><code>http://</code>: The <strong>scheme</strong>, which tells your browser or program how to communicate with the web server. This will typically be either <code>http:</code> or <code>https:</code>.</li>
<li><code>api.census.gov</code>: The <strong>hostname</strong> or <strong>host address</strong>, which is a name that identifies the web server that will process the request.</li>
</ul></li>
<li><code>data/2019/acs/acs1</code>: The <strong>file path</strong>, which tells the web server how to get to the desired resource.</li>
<li><code>?get=NAME,B02015_009E,B02015_009M&amp;for=state:*</code>: The <strong>query string</strong> or <strong>query parameters</strong>, which provide the parameters for the function you would like to call.
<ul>
<li>This is a string of key-value pairs separated by <code>&amp;</code>. That is, the general structure of this part is <code>key1=value1&amp;key2=value2</code>.</li>
</ul></li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">key</th>
<th style="text-align: left;">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>get</code></td>
<td style="text-align: left;"><code>NAME,B02015_009E,B02015_009M</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>for</code></td>
<td style="text-align: left;"><code>state:*</code></td>
</tr>
</tbody>
</table>
</section>
<section id="example-web-apis" class="level3">
<h3 class="anchored" data-anchor-id="example-web-apis">Example Web API‚Äôs</h3>
<p>A large variety of web APIs provide data. Almost all reasonably large commercial websites offer Web APIs. Todd Motto has compiled an expansive list of <a href="https://github.com/toddmotto/public-apis">Public Web APIs</a> on GitHub. Browse this list to see what data sources are available.</p>
</section>
</section>
<section id="wrapper-packages" class="level2">
<h2 class="anchored" data-anchor-id="wrapper-packages">Wrapper packages</h2>
<p>In R, it is easiest to access Web APIs through a <strong>wrapper package</strong>, an R package written specifically for a particular Web API.</p>
<ul>
<li>The R development community has already contributed wrapper packages for most large Web APIs.</li>
<li>To find a wrapper package, search the web for ‚ÄúR package‚Äù and the name of the website. For example:
<ul>
<li>Searching for ‚ÄúR Reddit package‚Äù returns <a href="https://cran.r-project.org/web/packages/RedditExtractoR/index.html">RedditExtractor</a></li>
<li>Searching for ‚ÄúR Weather.com package‚Äù returns <a href="https://ram-n.github.io/weatherData/">weatherData</a></li>
</ul></li>
<li><a href="https://ropensci.org/packages/">rOpenSci</a> also has a good collection of wrapper packages.</li>
</ul>
<p>In our work with maps, we‚Äôve used the <code>tidycensus</code> package to obtain census data to display on maps. <code>tidycensus</code> is a wrapper package that makes it easy to obtain desired census information:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(</span>
<span id="cb1-2"><a href="#cb1-2"></a>    <span class="at">year =</span> <span class="dv">2020</span>,</span>
<span id="cb1-3"><a href="#cb1-3"></a>    <span class="at">state =</span> <span class="st">"MN"</span>,</span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="at">geography =</span> <span class="st">"tract"</span>,</span>
<span id="cb1-5"><a href="#cb1-5"></a>    <span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"B01003_001"</span>, <span class="st">"B19013_001"</span>),</span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="at">output =</span> <span class="st">"wide"</span>,</span>
<span id="cb1-7"><a href="#cb1-7"></a>    <span class="at">geometry =</span> <span class="cn">TRUE</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Extra Resources:</p>
<ul>
<li><code>tidycensus</code>: wrapper package that provides an interface to a few census datasets with map geometry included
<ul>
<li>Full documentation is available at <a href="https://walker-data.com/tidycensus/" class="uri">https://walker-data.com/tidycensus/</a></li>
</ul></li>
<li><code>censusapi</code>: wrapper package that offers an interface to all census datasets
<ul>
<li>Full documentation is available at <a href="https://www.hrecht.com/censusapi/" class="uri">https://www.hrecht.com/censusapi/</a></li>
</ul></li>
</ul>
<p>What is going on behind the scenes with <code>get_acs()</code>? Let‚Äôs look at access Web API‚Äôs directly with URL‚Äôs.</p>
</section>
<section id="accessing-web-apis-directly" class="level2">
<h2 class="anchored" data-anchor-id="accessing-web-apis-directly">Accessing web APIs directly</h2>
<section id="getting-a-census-api-key" class="level3">
<h3 class="anchored" data-anchor-id="getting-a-census-api-key">Getting a Census API key</h3>
<p>Many APIs require users to obtain a <strong>key</strong> to use their services.</p>
<ul>
<li>This lets organizations keep track of what data is being used.</li>
<li>It also <strong>rate limits</strong> their API and ensures programs don‚Äôt make too many requests per day/minute/hour. Be aware that most APIs do have rate limits ‚Äî especially for their free tiers.</li>
</ul>
<p>Navigate to <a href="https://api.census.gov/data/key_signup.html" class="uri">https://api.census.gov/data/key_signup.html</a> to obtain a Census API key:</p>
<ul>
<li>Organization: Macalester College</li>
<li>Email: Your Mac email address</li>
</ul>
<p>You will get the message:</p>
<blockquote class="blockquote">
<p>Your request for a new API key has been successfully submitted. Please check your email. In a few minutes you should receive a message with instructions on how to activate your new key.</p>
</blockquote>
<p>Check your email. Copy and paste your key into a new text file:</p>
<ul>
<li>File &gt; New File &gt; Text File (towards the bottom of the menu)</li>
<li>Save as <code>census_api_key.txt</code> in the same folder as this <code>.qmd</code>. üìå Don‚Äôt commit this file to GitHub. Make Git ignores it via GitHub Desktop (<strong>Right click</strong> the file ‚Äì&gt; select <strong>Ignore file (add to .gitignore)</strong>.</li>
</ul>
<p>Read in the key with the following code:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>census_api_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"census_api_key.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="navigating-api-documentation" class="level3">
<h3 class="anchored" data-anchor-id="navigating-api-documentation">Navigating API documentation</h3>
<p>Navigate to the <a href="https://www.census.gov/data/developers/guidance/api-user-guide.html">Census API user guide</a> and click on the ‚ÄúExample API Queries‚Äù tab. Let‚Äôs look at the Population Estimates Example and the American Community Survey (ACS) Example. These examples walk us through the steps to incrementally build up a URL to obtain desired data. This URL is known as a web API <strong>request</strong>.</p>
<p><code>https://api.census.gov/data/2019/acs/acs1?get=NAME,B02015_009E,B02015_009M&amp;for=state:*</code></p>
<p>For this request,</p>
<ul>
<li>we can adjust the <strong>path</strong> to change desired dataset (acs1) and year</li>
<li>we can adjust the <strong>query string</strong> to get different variables (<code>get</code>) and for different states (<code>for</code>)</li>
</ul>
<p><code>?get=NAME,B02015_009E,B02015_009M&amp;for=state:*</code></p>
<p>Typically, each of these URL components will be specified in the API documentation. Sometimes, the scheme, hostname, and path (<code>https://api.census.gov/data/2019/acs/acs1</code>) will be referred to as the <strong><a href="https://en.wikipedia.org/wiki/Web_API#Endpoints">endpoint</a></strong> for the API call.</p>
</section>
<section id="building-a-url-with-httr2" class="level3">
<h3 class="anchored" data-anchor-id="building-a-url-with-httr2">Building a URL with <code>httr2</code></h3>
<p>We will use the <code>httr2</code> package to build up a full URL from its parts because of URLs need to be <a href="https://en.wikipedia.org/wiki/Percent-encoding">percent encoded</a>.</p>
<ul>
<li><code>request()</code> creates an API request object using the <strong>base URL</strong></li>
<li><code>req_url_path_append()</code> builds up the URL by adding path components separated by <code>/</code></li>
<li><code>req_url_query()</code> adds the <code>?</code> separating the endpoint from the query and sets the key-value pairs in the query
<ul>
<li>The <code>.multi</code> argument controls how multiple values for a given key are combined.</li>
<li>The <code>I()</code> function around <code>"state:*"</code> inhibits parsing of special characters like <code>:</code> and <code>*</code>. (It‚Äôs known as the ‚Äúas-is‚Äù function.)</li>
<li>The backticks around <code>for</code> are needed because <code>for</code> is a reserved word in R (for for-loops). You‚Äôll need backticks whenever the key name has special characters (like spaces, dashes).</li>
<li>We can see from <a href="https://www.census.gov/data/developers/guidance/api-user-guide.Help_&amp;_Contact_Us.html">here</a> that providing an API key is achieved with <code>key=YOUR_API_KEY</code>.</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://api.census.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"data"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"2019"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"acs"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"acs1"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="fu">req_url_query</span>(<span class="at">get =</span> <span class="fu">c</span>(<span class="st">"NAME"</span>, <span class="st">"B02015_009E"</span>, <span class="st">"B02015_009M"</span>), <span class="st">`</span><span class="at">for</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">I</span>(<span class="st">"state:*"</span>), <span class="at">key =</span> census_api_key, <span class="at">.multi =</span> <span class="st">"comma"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Why would we ever use these steps instead of just using the full URL as a string?</strong></p>
<ul>
<li>To generalize this code with functions!</li>
<li>To handle special characters
<ul>
<li>e.g., query parameters might have spaces, which need to be represented in a particular way in a URL (URLs can‚Äôt contain spaces)</li>
</ul></li>
</ul>
</section>
<section id="sending-a-request-with-httr2" class="level3">
<h3 class="anchored" data-anchor-id="sending-a-request-with-httr2">Sending a request with <code class="unnumbered">httr2</code></h3>
<p>Once we‚Äôve fully constructed our request, we can use <code>req_perform()</code> to send out the API request and get a <strong>response</strong>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>resp <span class="ot">&lt;-</span> <span class="fu">req_perform</span>(req)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="getting-a-response-with-httr2" class="level3">
<h3 class="anchored" data-anchor-id="getting-a-response-with-httr2">Getting a response with <code>httr2</code></h3>
<p>We see from <code>Content-Type</code> that the format of the response is something called JSON. We can navigate to the request URL to see the structure of this output.</p>
<ul>
<li>We can use <code>resp_body_json()</code> in <code>httr2</code> to parse the JSON into a nicer R format.
<ul>
<li>This function uses <code>fromJSON()</code> behind the scenes.</li>
<li>Without <code>simplifyVector = TRUE</code>, the JSON is read in as a list.</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>resp_json_df <span class="ot">&lt;-</span> resp <span class="sc">|&gt;</span> <span class="fu">resp_body_json</span>(<span class="at">simplifyVector =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co"># Data Cleaning</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>resp_json_df <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">row_to_names</span>(resp_json_df, <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="co"># Move 1st row to Names</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="co"># Convert Matrix to Data Frame</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">'B'</span>), as.numeric)) <span class="co"># Convert all variables that start with B to numeric</span></span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="fu">head</span>(resp_json_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      NAME B02015_009E B02015_009M state
1 Illinois         655         511    17
2  Georgia        3162        1336    13
3    Idaho          NA          NA    16
4   Hawaii          56          92    15
5  Indiana        1344        1198    18
6     Iowa         685         705    19</code></pre>
</div>
</div>
<p>To learn more about JSON, consult the following readings:</p>
<ol type="1">
<li><a href="https://blog.scottlowe.org/2013/11/08/a-non-programmers-introduction-to-json/">A Non-Programmer‚Äôs Introduction to JSON</a></li>
<li><a href="https://cran.r-project.org/web/packages/jsonlite/vignettes/json-aaquickstart.html">Getting Started With JSON and jsonlite</a></li>
<li><a href="https://cran.r-project.org/web/packages/jsonlite/vignettes/json-apis.html">Fetching JSON data from REST APIs</a></li>
</ol>
</section>
</section>
<section id="more-api-examples" class="level2">
<h2 class="anchored" data-anchor-id="more-api-examples">More API Examples</h2>
<section id="board-game-geek-xml-data" class="level3">
<h3 class="anchored" data-anchor-id="board-game-geek-xml-data">Board Game Geek &amp; XML Data</h3>
<p>The <a href="https://boardgamegeek.com/wiki/page/BGG_XML_API2">Board Game Geek API</a> is referenced in the <a href="https://github.com/toddmotto/public-apis?tab=readme-ov-file#games--comics">Games &amp; Comics</a> section of <a href="https://github.com/toddmotto/public-apis">toddmotto‚Äôs public API list</a>.</p>
<p>Our goal is to use the search API at the bottom of the page.</p>
<p>Let‚Äôs start at the top of the API documentation page to see how to navigate this reference.</p>
<ul>
<li>We can see from the XML references at the top that we will be expecting a new output format: XML stands for Extensible Markup Language</li>
<li>The ‚ÄúRoot Path‚Äù section tells us the base URL for the Board Game Geeks API endpoints and related APIs: <a href="https://boardgamegeek.com/xmlapi2/" class="uri">https://boardgamegeek.com/xmlapi2/</a></li>
<li>The ‚ÄúSearch‚Äù section at the bottom of the page tells us:
<ul>
<li>the path for the search endpoint (<code>/search</code>)</li>
<li>what query parameters are possible</li>
<li>particular formatting instructions for query parameter values</li>
</ul></li>
</ul>
<p>The following request searches for board games, board game accessories, and board game expansions with the words ‚Äúmystery‚Äù and ‚Äúcurse‚Äù in the title:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://boardgamegeek.com/xmlapi2"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"search"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="fu">req_url_query</span>(<span class="at">query =</span> <span class="fu">I</span>(<span class="st">"mystery+curse"</span>), <span class="at">type =</span> <span class="fu">I</span>(<span class="st">"boardgame,boardgameaccessory,boardgameexpansion"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>When we use <code>req_perform()</code>, we see from <code>Content-Type</code> that the format of the response is something called XML. We can navigate to the request URL to see the structure of this output.</p>
<ul>
<li>XML (Extensible Markup Language) is a tree structure of named nodes and attributes.</li>
<li>We can use <code>resp_body_xml()</code> to read in the XML as an R object.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>resp <span class="ot">&lt;-</span> <span class="fu">req_perform</span>(req)</span>
<span id="cb8-2"><a href="#cb8-2"></a>resp</span>
<span id="cb8-3"><a href="#cb8-3"></a>resp <span class="ot">&lt;-</span> <span class="fu">resp_body_xml</span>(resp)</span>
<span id="cb8-4"><a href="#cb8-4"></a>resp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The XML output is not packaged in a nice way. (We‚Äôd love to have a data frame.) We can use the <code>xml2</code> package to explore and navigate the XML structure to extract the information we need.</p>
<p>Let‚Äôs first use the <code>xml_structure()</code> function to see how information is organized:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">xml_structure</span>(resp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The key navigation and extraction functions in <code>xml2</code> are:</p>
<ul>
<li><code>xml_children()</code>: Get nodes that are nested inside
<ul>
<li>Like getting the first level bullet points inside a given bullet point</li>
</ul></li>
<li><code>xml_find_all()</code>: Finds nodes matching an XPath expression (XPath stands for XML path)
<ul>
<li>XPath expressions are like string regular expressions for XML trees</li>
<li>See <a href="https://www.w3schools.com/xml/xpath_intro.asp">here</a> for a deeper dive into XPath</li>
</ul></li>
<li><code>xml_attr()</code>: Selects the value of an attribute (the information to the right of the <code>=</code> in quotes)
<ul>
<li><code>&lt;node_name attribute_name1="attribute_value1" attribute_name2="attribute_value2"&gt;</code></li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Get the item nodes in 2 different ways</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>resp <span class="sc">|&gt;</span> <span class="fu">xml_find_all</span>(<span class="st">"item"</span>)</span>
<span id="cb10-3"><a href="#cb10-3"></a>resp <span class="sc">|&gt;</span> <span class="fu">xml_children</span>()</span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co"># Get the item "type"</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>resp <span class="sc">|&gt;</span> <span class="fu">xml_find_all</span>(<span class="st">"item"</span>) <span class="sc">|&gt;</span> <span class="fu">xml_attr</span>(<span class="st">"type"</span>)</span>
<span id="cb10-7"><a href="#cb10-7"></a></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="co"># The &lt;name&gt; and &lt;yearpublished&gt; nodes are nested within each &lt;item&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>resp <span class="sc">|&gt;</span> <span class="fu">xml_find_all</span>(<span class="st">"item/name"</span>)</span>
<span id="cb10-10"><a href="#cb10-10"></a>resp <span class="sc">|&gt;</span> <span class="fu">xml_find_all</span>(<span class="st">"item/yearpublished"</span>) <span class="co"># Notice that this is length 8 instead of 9!</span></span>
<span id="cb10-11"><a href="#cb10-11"></a></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co"># Get the "primary" or "alternate" designation for each name</span></span>
<span id="cb10-13"><a href="#cb10-13"></a>resp <span class="sc">|&gt;</span> <span class="fu">xml_find_all</span>(<span class="st">"item/name"</span>) <span class="sc">|&gt;</span> <span class="fu">xml_attr</span>(<span class="st">"type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Exercises</strong></p>
<ol type="1">
<li>Get the board game name (e.g., ‚ÄúMurder Mystery‚Ä¶‚Äù and ‚ÄúRobinson Crusoe‚Äù)</li>
<li>Get the board game ID number (e.g., 63495, 40175)</li>
</ol>
<blockquote class="blockquote">
<p>This activity wasn‚Äôt working. It seems to be a problem with the API</p>
</blockquote>
</section>
<section id="new-york-times-api" class="level3">
<h3 class="anchored" data-anchor-id="new-york-times-api">New York Times API</h3>
<p>This example will build on the <a href="https://developer.nytimes.com/">New York Times Web API</a>, which provides access to news articles, movie reviews, book reviews, and many other data.</p>
<p>We will specifically focus on the <a href="https://developer.nytimes.com/docs/articlesearch-product/1/overview">Article Search API</a>, which finds information about news articles that contain a particular word or phrase.</p>
<p>To get started with the NY Times API, you must <a href="https://developer.nytimes.com/accounts/create">register and get an <strong>authentication key</strong></a>. Signup only takes a few seconds, and it lets the New York Times make sure nobody abuses their API for commercial purposes. It also <strong>rate limits</strong> their API and ensures programs don‚Äôt make too many requests per day. For the NY Times API, this limit is 1000 calls per day.</p>
<p>Once you have signed up, verified your email, log back in to https://developer.nytimes.com. Under your email address, click on Apps and Create a new App (call it First API) and enable Article Search API, then press Save. This creates an <strong>authentication key</strong>, which is a 32 digit string with numbers and the letters a-e.</p>
<p>As with your census API key, save this key in a <code>.txt</code> file, and read it in and store this in a variable called <code>times_key</code>. üìå Again, don‚Äôt commit this file to GitHub. Make Git ignores it via GitHub Desktop (<strong>Right click</strong> the file ‚Äì&gt; select <strong>Ignore file (add to .gitignore)</strong>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>times_key <span class="ot">&lt;-</span> <span class="fu">read_lines</span>(<span class="st">"times_key"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Open this URL in your browser (you should replace <code>MY_KEY</code> with the API key you were given).</p>
<pre><code>http://api.nytimes.com/svc/search/v2/articlesearch.json?q=gamergate&amp;api-key=MY_KEY</code></pre>
<p>The text you see in the browser is the response data (in JSON format).</p>
<p>This URL has the same structure that we discussed above for the census API:</p>
<ul>
<li><code>http://</code> ‚Äî The <strong>scheme</strong>, which tells your browser or program how to communicate with the web server. This will typically be either <code>http:</code> or <code>https:</code>.</li>
<li><code>api.nytimes.com</code> ‚Äî The <strong>hostname</strong>, which is a name that identifies the web server that will process the request.</li>
<li><code>/svc/search/v2/articlesearch.json</code> ‚Äî The <strong>path</strong>, which tells the web server what function you would like to call (a function for searching articles).</li>
<li><code>?q=gamergate&amp;api-key=MY_KEY</code> ‚Äî The <strong>query parameters</strong>, which provide the parameters for the function you would like to call. The key value pairs are the following:</li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">key</th>
<th style="text-align: left;">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">q</td>
<td style="text-align: left;">gamergate</td>
</tr>
<tr class="even">
<td style="text-align: left;">api-key</td>
<td style="text-align: left;">MY_KEY</td>
</tr>
</tbody>
</table>
<p>The scheme, hostname, and path (<code>http://api.nytimes.com/svc/search/v2/articlesearch.json</code>) together form the <strong><a href="https://en.wikipedia.org/wiki/Web_API#Endpoints">endpoint</a></strong> for the API call.</p>
<p>We can use the <code>httr2</code> package to build up a full URL from its parts:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"http://api.nytimes.com"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"svc"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"search"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-4"><a href="#cb13-4"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"v2"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-5"><a href="#cb13-5"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"articlesearch.json"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-6"><a href="#cb13-6"></a>    <span class="fu">req_url_query</span>(<span class="at">q =</span> <span class="st">"gamergate"</span>, <span class="st">`</span><span class="at">api-key</span><span class="st">`</span> <span class="ot">=</span> times_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can write a function to generate the URL for a user-specified query:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>create_nyt_url <span class="ot">&lt;-</span> <span class="cf">function</span>(query, key) {</span>
<span id="cb14-2"><a href="#cb14-2"></a>    <span class="fu">request</span>(<span class="st">"http://api.nytimes.com"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3"></a>        <span class="fu">req_url_path_append</span>(<span class="st">"svc"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-4"><a href="#cb14-4"></a>        <span class="fu">req_url_path_append</span>(<span class="st">"search"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-5"><a href="#cb14-5"></a>        <span class="fu">req_url_path_append</span>(<span class="st">"v2"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-6"><a href="#cb14-6"></a>        <span class="fu">req_url_path_append</span>(<span class="st">"articlesearch.json"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-7"><a href="#cb14-7"></a>        <span class="fu">req_url_query</span>(<span class="at">q =</span> query, <span class="st">`</span><span class="at">api-key</span><span class="st">`</span> <span class="ot">=</span> key)</span>
<span id="cb14-8"><a href="#cb14-8"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let‚Äôs use this function to find articles related to:</p>
<ul>
<li><code>Ferris Bueller's Day Off</code> (note the spaces and the apostrophe)</li>
<li><code>Penn &amp; Teller</code> (note the spaces and the punctuation mark <code>&amp;</code>)</li>
</ul>
<p>Let‚Äôs see how these queries are translated into the URLs:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>req_fb <span class="ot">&lt;-</span> <span class="fu">create_nyt_url</span>(<span class="at">query =</span> <span class="st">"Ferris Bueller's Day Off"</span>, <span class="at">key =</span> times_key)</span>
<span id="cb15-2"><a href="#cb15-2"></a>req_pt <span class="ot">&lt;-</span> <span class="fu">create_nyt_url</span>(<span class="at">query =</span> <span class="st">"Penn &amp; Teller"</span>, <span class="at">key =</span> times_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can use <code>req_perform()</code> to send out the request and <code>resp_body_json()</code> to parse the resulting JSON:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co">#resp_pt &lt;- req_pt |&gt; req_perform() |&gt; resp_body_json(simplifyVector = TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="exploring-complex-lists" class="level4">
<h4 class="anchored" data-anchor-id="exploring-complex-lists">Exploring complex lists</h4>
<p><code>resp_pt</code> is a <strong>list</strong>. A list is a useful structure for storing elements of different types. Data frames are special cases of lists where each list element has the same length (but where the list elements have different classes).</p>
<p>Lists are a very flexible data structure but can be very confusing because list elements can be lists themselves!</p>
<p>We can explore the structure of a list in two ways:</p>
<ul>
<li>Entering <code>View(list_object)</code> in the Console. The triangle buttons on the left allow you to toggle dropdowns to explore list elements.</li>
<li>Using the <code>str()</code> (structure) function.</li>
</ul>
<p>Using base R subsetting, we can access elements of a list in three ways:</p>
<ul>
<li>By <em>position</em> with double square brackets <code>[[</code>:</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># This gets the first element of the list</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="co"># resp_pt[[1]]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>By <em>name</em> with double square brackets <code>[[</code>: (note that list elements are not always named, so this won‚Äôt always be possible)</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># # Accessing by name directly</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co"># resp_pt[["status"]]</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co"># </span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co"># # Accessing via a variable</span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co"># which_element &lt;- "status"</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="co"># resp_pt[[which_element]]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>By <em>name</em> with a dollar sign <code>$</code>: (Helpful tip: For this mode of access, RStudio allows tab completion to fill in the full name)</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># resp_pt$status</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can retrieve these <em>nested</em> attributes by sequentially accessing the object keys from the outside in. For example, the <code>meta</code> element would be accessed as follows:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># resp_pt$response$meta</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Exercise:</strong> In the <code>resp_pt</code> object, retrieve the data associated with:</p>
<ul>
<li>the <code>copyright</code> key</li>
<li>the number of <code>hits</code> (number of search results) within the <code>meta</code> object</li>
<li>the abstracts and leading paragraphs of the articles found in the search</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># resp_pt$copyright</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="co"># </span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="co"># resp_pt$response$meta$hits</span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="co"># </span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co"># resp_pt$response$docs$abstract</span></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="co"># resp_pt$response$docs$lead_paragraph</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="done" class="level2">
<h2 class="anchored" data-anchor-id="done">Done!</h2>
<ul>
<li>Check the ICA Instructions for how to (a) push your code to GitHub and (b) update your portfolio website</li>
</ul>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../../src/ica/12-iteration-2-notes.html" class="pagination-link" aria-label="12 Loops+Iter P2">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">12 Loops+Iter P2</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../src/ica/15-scraping-notes.html" class="pagination-link" aria-label="15 Web scraping">
        <span class="nav-page-text"><span class="chapter-title">15 Web scraping</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb22" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb22-1"><a href="#cb22-1"></a><span class="co">---</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="an">title:</span><span class="co"> "14 APIs P2"</span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="co">---</span></span>
<span id="cb22-4"><a href="#cb22-4"></a></span>
<span id="cb22-5"><a href="#cb22-5"></a></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="fu">## üß© Learning Goals</span></span>
<span id="cb22-7"><a href="#cb22-7"></a></span>
<span id="cb22-8"><a href="#cb22-8"></a>By the end of this lesson, you should be able to:</span>
<span id="cb22-9"><a href="#cb22-9"></a><span class="ss">- </span>Explain what an API is</span>
<span id="cb22-10"><a href="#cb22-10"></a><span class="ss">- </span>Set up an API key for a public API</span>
<span id="cb22-11"><a href="#cb22-11"></a><span class="ss">- </span>Develop comfort in using a URL-method of calling a web API</span>
<span id="cb22-12"><a href="#cb22-12"></a><span class="ss">- </span>Recognize the structure in a URL for a web API and adjust for your purposes</span>
<span id="cb22-13"><a href="#cb22-13"></a><span class="ss">- </span>Explore and subset complex nested lists</span>
<span id="cb22-14"><a href="#cb22-14"></a></span>
<span id="cb22-15"><a href="#cb22-15"></a></span>
<span id="cb22-16"><a href="#cb22-16"></a><span class="in">```{r setup_14, echo=FALSE, message=FALSE}</span></span>
<span id="cb22-17"><a href="#cb22-17"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb22-18"><a href="#cb22-18"></a><span class="fu">library</span>(httr2)</span>
<span id="cb22-19"><a href="#cb22-19"></a><span class="fu">library</span>(httr)</span>
<span id="cb22-20"><a href="#cb22-20"></a><span class="fu">library</span>(xml2)</span>
<span id="cb22-21"><a href="#cb22-21"></a><span class="in">```</span></span>
<span id="cb22-22"><a href="#cb22-22"></a></span>
<span id="cb22-23"><a href="#cb22-23"></a></span>
<span id="cb22-24"><a href="#cb22-24"></a><span class="fu">## APIs</span></span>
<span id="cb22-25"><a href="#cb22-25"></a></span>
<span id="cb22-26"><a href="#cb22-26"></a>An **API** stands for **Application Programming Interface**, and this term describes a general class of tools that allows computer software, rather than humans, to interact with an organization's data. </span>
<span id="cb22-27"><a href="#cb22-27"></a></span>
<span id="cb22-28"><a href="#cb22-28"></a><span class="ss">- </span>*Application* refers to software.</span>
<span id="cb22-29"><a href="#cb22-29"></a><span class="ss">- </span>*Interface* can be thought of as a contract of service between two applications. This contract defines how the two communicate with each other using requests and responses. </span>
<span id="cb22-30"><a href="#cb22-30"></a>  </span>
<span id="cb22-31"><a href="#cb22-31"></a>Every API has documentation for how software developers should structure requests for data / information and in what format to expect responses.</span>
<span id="cb22-32"><a href="#cb22-32"></a></span>
<span id="cb22-33"><a href="#cb22-33"></a></span>
<span id="cb22-34"><a href="#cb22-34"></a><span class="fu">##  Web APIs</span></span>
<span id="cb22-35"><a href="#cb22-35"></a></span>
<span id="cb22-36"><a href="#cb22-36"></a><span class="co">[</span><span class="ot">Web APIs</span><span class="co">](https://en.wikipedia.org/wiki/Web_API)</span>, or Web Application Programming Interfaces, which focus on transmitting requests and responses for raw data through a web browser.</span>
<span id="cb22-37"><a href="#cb22-37"></a></span>
<span id="cb22-38"><a href="#cb22-38"></a><span class="ss">- </span>Our browsers communicate with web servers using a technology called <span class="co">[</span><span class="ot">HTTP</span><span class="co">](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol)</span> or Hypertext Transfer Protocol.</span>
<span id="cb22-39"><a href="#cb22-39"></a><span class="ss">- </span>Programming languages such as R can also use HTTP to communicate with web servers. </span>
<span id="cb22-40"><a href="#cb22-40"></a></span>
<span id="cb22-41"><a href="#cb22-41"></a></span>
<span id="cb22-42"><a href="#cb22-42"></a><span class="fu">### URL</span></span>
<span id="cb22-43"><a href="#cb22-43"></a></span>
<span id="cb22-44"><a href="#cb22-44"></a>Every document on the Web has a unique address. This address is known as Uniform Resource Locator (URL).</span>
<span id="cb22-45"><a href="#cb22-45"></a></span>
<span id="cb22-46"><a href="#cb22-46"></a>Every URL has the same general structure. Let's look at this example:</span>
<span id="cb22-47"><a href="#cb22-47"></a></span>
<span id="cb22-48"><a href="#cb22-48"></a><span class="in">`https://api.census.gov/data/2019/acs/acs1?get=NAME,B02015_009E,B02015_009M&amp;for=state:*`</span></span>
<span id="cb22-49"><a href="#cb22-49"></a></span>
<span id="cb22-50"><a href="#cb22-50"></a><span class="ss">- </span><span class="in">`https://api.census.gov`</span>: This is the **base URL**.</span>
<span id="cb22-51"><a href="#cb22-51"></a><span class="ss">    - </span><span class="in">`http://`</span>: The **scheme**, which tells your browser or program how to communicate with the web server. This will typically be either <span class="in">`http:`</span> or <span class="in">`https:`</span>.</span>
<span id="cb22-52"><a href="#cb22-52"></a><span class="ss">    - </span><span class="in">`api.census.gov`</span>: The **hostname** or **host address**, which is a name that identifies the web server that will process the request.</span>
<span id="cb22-53"><a href="#cb22-53"></a><span class="ss">- </span><span class="in">`data/2019/acs/acs1`</span>: The **file path**, which tells the web server how to get to the desired resource.</span>
<span id="cb22-54"><a href="#cb22-54"></a><span class="ss">- </span><span class="in">`?get=NAME,B02015_009E,B02015_009M&amp;for=state:*`</span>: The **query string** or **query parameters**, which provide the parameters for the function you would like to call.</span>
<span id="cb22-55"><a href="#cb22-55"></a><span class="ss">    - </span>This is a string of key-value pairs separated by <span class="in">`&amp;`</span>. That is, the general structure of this part is <span class="in">`key1=value1&amp;key2=value2`</span>.</span>
<span id="cb22-56"><a href="#cb22-56"></a></span>
<span id="cb22-57"><a href="#cb22-57"></a>key      value</span>
<span id="cb22-58"><a href="#cb22-58"></a>----     ------</span>
<span id="cb22-59"><a href="#cb22-59"></a><span class="in">`get`</span>      <span class="in">`NAME,B02015_009E,B02015_009M`</span></span>
<span id="cb22-60"><a href="#cb22-60"></a><span class="in">`for`</span>      <span class="in">`state:*`</span></span>
<span id="cb22-61"><a href="#cb22-61"></a></span>
<span id="cb22-62"><a href="#cb22-62"></a><span class="fu">### Example Web API's</span></span>
<span id="cb22-63"><a href="#cb22-63"></a></span>
<span id="cb22-64"><a href="#cb22-64"></a>A large variety of web APIs provide data. Almost all reasonably large commercial websites offer Web APIs. Todd Motto has compiled an expansive list of <span class="co">[</span><span class="ot">Public Web APIs</span><span class="co">](https://github.com/toddmotto/public-apis)</span> on GitHub. </span>
<span id="cb22-65"><a href="#cb22-65"></a>Browse this list to see what data sources are available.</span>
<span id="cb22-66"><a href="#cb22-66"></a></span>
<span id="cb22-67"><a href="#cb22-67"></a></span>
<span id="cb22-68"><a href="#cb22-68"></a><span class="fu">## Wrapper packages</span></span>
<span id="cb22-69"><a href="#cb22-69"></a></span>
<span id="cb22-70"><a href="#cb22-70"></a>In R, it is easiest to access Web APIs through a **wrapper package**, an R package written specifically for a particular Web API.</span>
<span id="cb22-71"><a href="#cb22-71"></a></span>
<span id="cb22-72"><a href="#cb22-72"></a><span class="ss">- </span>The R development community has already contributed wrapper packages for most large Web APIs.</span>
<span id="cb22-73"><a href="#cb22-73"></a><span class="ss">- </span>To find a wrapper package, search the web for "R package" and the name of the website. For example:</span>
<span id="cb22-74"><a href="#cb22-74"></a><span class="ss">    - </span>Searching for "R Reddit package" returns <span class="co">[</span><span class="ot">RedditExtractor</span><span class="co">](https://cran.r-project.org/web/packages/RedditExtractoR/index.html)</span></span>
<span id="cb22-75"><a href="#cb22-75"></a><span class="ss">    - </span>Searching for "R Weather.com package" returns <span class="co">[</span><span class="ot">weatherData</span><span class="co">](https://ram-n.github.io/weatherData/)</span></span>
<span id="cb22-76"><a href="#cb22-76"></a><span class="ss">- </span><span class="co">[</span><span class="ot">rOpenSci</span><span class="co">](https://ropensci.org/packages/)</span> also has a good collection of wrapper packages.</span>
<span id="cb22-77"><a href="#cb22-77"></a></span>
<span id="cb22-78"><a href="#cb22-78"></a>In our work with maps, we've used the <span class="in">`tidycensus`</span> package to obtain census data to display on maps. <span class="in">`tidycensus`</span> is a wrapper package that makes it easy to obtain desired census information:</span>
<span id="cb22-79"><a href="#cb22-79"></a></span>
<span id="cb22-80"><a href="#cb22-80"></a><span class="in">```{r tidycensus, eval=FALSE}</span></span>
<span id="cb22-81"><a href="#cb22-81"></a>tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(</span>
<span id="cb22-82"><a href="#cb22-82"></a>    <span class="at">year =</span> <span class="dv">2020</span>,</span>
<span id="cb22-83"><a href="#cb22-83"></a>    <span class="at">state =</span> <span class="st">"MN"</span>,</span>
<span id="cb22-84"><a href="#cb22-84"></a>    <span class="at">geography =</span> <span class="st">"tract"</span>,</span>
<span id="cb22-85"><a href="#cb22-85"></a>    <span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"B01003_001"</span>, <span class="st">"B19013_001"</span>),</span>
<span id="cb22-86"><a href="#cb22-86"></a>    <span class="at">output =</span> <span class="st">"wide"</span>,</span>
<span id="cb22-87"><a href="#cb22-87"></a>    <span class="at">geometry =</span> <span class="cn">TRUE</span></span>
<span id="cb22-88"><a href="#cb22-88"></a>)</span>
<span id="cb22-89"><a href="#cb22-89"></a><span class="in">```</span></span>
<span id="cb22-90"><a href="#cb22-90"></a></span>
<span id="cb22-91"><a href="#cb22-91"></a>Extra Resources:</span>
<span id="cb22-92"><a href="#cb22-92"></a></span>
<span id="cb22-93"><a href="#cb22-93"></a><span class="ss">- </span><span class="in">`tidycensus`</span>: wrapper package that provides an interface to a few census datasets with map geometry included</span>
<span id="cb22-94"><a href="#cb22-94"></a><span class="ss">    - </span>Full documentation is available at <span class="ot">&lt;https://walker-data.com/tidycensus/&gt;</span></span>
<span id="cb22-95"><a href="#cb22-95"></a><span class="ss">- </span><span class="in">`censusapi`</span>: wrapper package that offers an interface to all census datasets</span>
<span id="cb22-96"><a href="#cb22-96"></a><span class="ss">    - </span>Full documentation is available at <span class="ot">&lt;https://www.hrecht.com/censusapi/&gt;</span></span>
<span id="cb22-97"><a href="#cb22-97"></a></span>
<span id="cb22-98"><a href="#cb22-98"></a>What is going on behind the scenes with <span class="in">`get_acs()`</span>? Let's look at access Web API's directly with URL's.</span>
<span id="cb22-99"><a href="#cb22-99"></a></span>
<span id="cb22-100"><a href="#cb22-100"></a></span>
<span id="cb22-101"><a href="#cb22-101"></a></span>
<span id="cb22-102"><a href="#cb22-102"></a><span class="fu">## Accessing web APIs directly</span></span>
<span id="cb22-103"><a href="#cb22-103"></a></span>
<span id="cb22-104"><a href="#cb22-104"></a><span class="fu">### Getting a Census API key</span></span>
<span id="cb22-105"><a href="#cb22-105"></a></span>
<span id="cb22-106"><a href="#cb22-106"></a>Many APIs require users to obtain a **key** to use their services.</span>
<span id="cb22-107"><a href="#cb22-107"></a></span>
<span id="cb22-108"><a href="#cb22-108"></a><span class="ss">- </span>This lets organizations keep track of what data is being used.</span>
<span id="cb22-109"><a href="#cb22-109"></a><span class="ss">- </span>It also **rate limits** their API and ensures programs don't make too many requests per day/minute/hour. Be aware that most APIs do have rate limits --- especially for their free tiers.</span>
<span id="cb22-110"><a href="#cb22-110"></a></span>
<span id="cb22-111"><a href="#cb22-111"></a>Navigate to <span class="ot">&lt;https://api.census.gov/data/key_signup.html&gt;</span> to obtain a Census API key:</span>
<span id="cb22-112"><a href="#cb22-112"></a></span>
<span id="cb22-113"><a href="#cb22-113"></a><span class="ss">- </span>Organization: Macalester College</span>
<span id="cb22-114"><a href="#cb22-114"></a><span class="ss">- </span>Email: Your Mac email address</span>
<span id="cb22-115"><a href="#cb22-115"></a></span>
<span id="cb22-116"><a href="#cb22-116"></a>You will get the message:</span>
<span id="cb22-117"><a href="#cb22-117"></a></span>
<span id="cb22-118"><a href="#cb22-118"></a><span class="at">&gt; Your request for a new API key has been successfully submitted. Please check your email. In a few minutes you should receive a message with instructions on how to activate your new key.</span></span>
<span id="cb22-119"><a href="#cb22-119"></a></span>
<span id="cb22-120"><a href="#cb22-120"></a>Check your email. Copy and paste your key into a new text file:</span>
<span id="cb22-121"><a href="#cb22-121"></a></span>
<span id="cb22-122"><a href="#cb22-122"></a><span class="ss">- </span>File &gt; New File &gt; Text File (towards the bottom of the menu)</span>
<span id="cb22-123"><a href="#cb22-123"></a><span class="ss">- </span>Save as <span class="in">`census_api_key.txt`</span> in the same folder as this <span class="in">`.qmd`</span>.  üìå Don't commit this file to GitHub.  Make Git ignores it via GitHub Desktop (**Right click** the file --&gt; select **Ignore file (add to .gitignore)**.</span>
<span id="cb22-124"><a href="#cb22-124"></a></span>
<span id="cb22-125"><a href="#cb22-125"></a>Read in the key with the following code:</span>
<span id="cb22-126"><a href="#cb22-126"></a></span>
<span id="cb22-127"><a href="#cb22-127"></a></span>
<span id="cb22-128"><a href="#cb22-128"></a><span class="in">```{r read_census_api_key2}</span></span>
<span id="cb22-129"><a href="#cb22-129"></a>census_api_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"census_api_key.txt"</span>)</span>
<span id="cb22-130"><a href="#cb22-130"></a><span class="in">```</span></span>
<span id="cb22-131"><a href="#cb22-131"></a></span>
<span id="cb22-132"><a href="#cb22-132"></a><span class="fu">### Navigating API documentation</span></span>
<span id="cb22-133"><a href="#cb22-133"></a></span>
<span id="cb22-134"><a href="#cb22-134"></a>Navigate to the <span class="co">[</span><span class="ot">Census API user guide</span><span class="co">](https://www.census.gov/data/developers/guidance/api-user-guide.html)</span> and click on the "Example API Queries" tab.  Let's look at the Population Estimates Example and the American Community Survey (ACS) Example. These examples walk us through the steps to incrementally build up a URL to obtain desired data. This URL is known as a web API **request**. </span>
<span id="cb22-135"><a href="#cb22-135"></a></span>
<span id="cb22-136"><a href="#cb22-136"></a><span class="in">`https://api.census.gov/data/2019/acs/acs1?get=NAME,B02015_009E,B02015_009M&amp;for=state:*`</span></span>
<span id="cb22-137"><a href="#cb22-137"></a></span>
<span id="cb22-138"><a href="#cb22-138"></a>For this request, </span>
<span id="cb22-139"><a href="#cb22-139"></a></span>
<span id="cb22-140"><a href="#cb22-140"></a><span class="ss">- </span>we can adjust the **path** to change desired dataset (acs1) and year </span>
<span id="cb22-141"><a href="#cb22-141"></a><span class="ss">- </span>we can adjust the **query string** to get different variables (<span class="in">`get`</span>) and for different states (<span class="in">`for`</span>)</span>
<span id="cb22-142"><a href="#cb22-142"></a>  </span>
<span id="cb22-143"><a href="#cb22-143"></a><span class="in">`?get=NAME,B02015_009E,B02015_009M&amp;for=state:*`</span> </span>
<span id="cb22-144"><a href="#cb22-144"></a></span>
<span id="cb22-145"><a href="#cb22-145"></a>Typically, each of these URL components will be specified in the API documentation. Sometimes, the scheme, hostname, and path (<span class="in">`https://api.census.gov/data/2019/acs/acs1`</span>) will be referred to as the **[endpoint](https://en.wikipedia.org/wiki/Web_API#Endpoints)** for the API call.</span>
<span id="cb22-146"><a href="#cb22-146"></a></span>
<span id="cb22-147"><a href="#cb22-147"></a><span class="fu">### Building a URL with `httr2`</span></span>
<span id="cb22-148"><a href="#cb22-148"></a></span>
<span id="cb22-149"><a href="#cb22-149"></a>We will use the <span class="in">`httr2`</span> package to build up a full URL from its parts because of URLs need to be <span class="co">[</span><span class="ot">percent encoded</span><span class="co">](https://en.wikipedia.org/wiki/Percent-encoding)</span>.</span>
<span id="cb22-150"><a href="#cb22-150"></a></span>
<span id="cb22-151"><a href="#cb22-151"></a><span class="ss">- </span><span class="in">`request()`</span> creates an API request object using the **base URL**</span>
<span id="cb22-152"><a href="#cb22-152"></a><span class="ss">- </span><span class="in">`req_url_path_append()`</span> builds up the URL by adding path components separated by <span class="in">`/`</span></span>
<span id="cb22-153"><a href="#cb22-153"></a><span class="ss">- </span><span class="in">`req_url_query()`</span> adds the <span class="in">`?`</span> separating the endpoint from the query and sets the key-value pairs in the query</span>
<span id="cb22-154"><a href="#cb22-154"></a><span class="ss">    - </span>The <span class="in">`.multi`</span> argument controls how multiple values for a given key are combined.</span>
<span id="cb22-155"><a href="#cb22-155"></a><span class="ss">    - </span>The <span class="in">`I()`</span> function around <span class="in">`"state:*"`</span> inhibits parsing of special characters like <span class="in">`:`</span> and <span class="in">`*`</span>. (It's known as the "as-is" function.)</span>
<span id="cb22-156"><a href="#cb22-156"></a><span class="ss">    - </span>The backticks around <span class="in">`for`</span> are needed because <span class="in">`for`</span> is a reserved word in R (for for-loops). You'll need backticks whenever the key name has special characters (like spaces, dashes).</span>
<span id="cb22-157"><a href="#cb22-157"></a><span class="ss">    - </span>We can see from <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.census.gov/data/developers/guidance/api-user-guide.Help_&amp;_Contact_Us.html)</span> that providing an API key is achieved with <span class="in">`key=YOUR_API_KEY`</span>.</span>
<span id="cb22-158"><a href="#cb22-158"></a></span>
<span id="cb22-159"><a href="#cb22-159"></a><span class="in">```{r httr2_census}</span></span>
<span id="cb22-160"><a href="#cb22-160"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://api.census.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-161"><a href="#cb22-161"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"data"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-162"><a href="#cb22-162"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"2019"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-163"><a href="#cb22-163"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"acs"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-164"><a href="#cb22-164"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"acs1"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-165"><a href="#cb22-165"></a>    <span class="fu">req_url_query</span>(<span class="at">get =</span> <span class="fu">c</span>(<span class="st">"NAME"</span>, <span class="st">"B02015_009E"</span>, <span class="st">"B02015_009M"</span>), <span class="st">`</span><span class="at">for</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">I</span>(<span class="st">"state:*"</span>), <span class="at">key =</span> census_api_key, <span class="at">.multi =</span> <span class="st">"comma"</span>)</span>
<span id="cb22-166"><a href="#cb22-166"></a><span class="in">```</span></span>
<span id="cb22-167"><a href="#cb22-167"></a></span>
<span id="cb22-168"><a href="#cb22-168"></a>**Why would we ever use these steps instead of just using the full URL as a string?**</span>
<span id="cb22-169"><a href="#cb22-169"></a></span>
<span id="cb22-170"><a href="#cb22-170"></a><span class="ss">- </span>To generalize this code with functions!</span>
<span id="cb22-171"><a href="#cb22-171"></a><span class="ss">- </span>To handle special characters</span>
<span id="cb22-172"><a href="#cb22-172"></a><span class="ss">    - </span>e.g., query parameters might have spaces, which need to be represented in a particular way in a URL (URLs can't contain spaces)</span>
<span id="cb22-173"><a href="#cb22-173"></a></span>
<span id="cb22-174"><a href="#cb22-174"></a><span class="fu">### Sending a request with `httr2`{-}</span></span>
<span id="cb22-175"><a href="#cb22-175"></a></span>
<span id="cb22-176"><a href="#cb22-176"></a>Once we've fully constructed our request, we can use <span class="in">`req_perform()`</span> to send out the API request and get a **response**.</span>
<span id="cb22-177"><a href="#cb22-177"></a></span>
<span id="cb22-178"><a href="#cb22-178"></a><span class="in">```{r census_request}</span></span>
<span id="cb22-179"><a href="#cb22-179"></a>resp <span class="ot">&lt;-</span> <span class="fu">req_perform</span>(req)</span>
<span id="cb22-180"><a href="#cb22-180"></a><span class="in">```</span></span>
<span id="cb22-181"><a href="#cb22-181"></a></span>
<span id="cb22-182"><a href="#cb22-182"></a><span class="fu">### Getting a response with `httr2`</span></span>
<span id="cb22-183"><a href="#cb22-183"></a></span>
<span id="cb22-184"><a href="#cb22-184"></a>We see from <span class="in">`Content-Type`</span> that the format of the response is something called JSON. We can navigate to the request URL to see the structure of this output.</span>
<span id="cb22-185"><a href="#cb22-185"></a></span>
<span id="cb22-186"><a href="#cb22-186"></a><span class="ss">- </span>We can use <span class="in">`resp_body_json()`</span> in <span class="in">`httr2`</span> to parse the JSON into a nicer R format.</span>
<span id="cb22-187"><a href="#cb22-187"></a><span class="ss">    - </span>This function uses <span class="in">`fromJSON()`</span> behind the scenes.</span>
<span id="cb22-188"><a href="#cb22-188"></a><span class="ss">    - </span>Without <span class="in">`simplifyVector = TRUE`</span>, the JSON is read in as a list. </span>
<span id="cb22-189"><a href="#cb22-189"></a></span>
<span id="cb22-190"><a href="#cb22-190"></a><span class="in">```{r census_json}</span></span>
<span id="cb22-191"><a href="#cb22-191"></a>resp_json_df <span class="ot">&lt;-</span> resp <span class="sc">|&gt;</span> <span class="fu">resp_body_json</span>(<span class="at">simplifyVector =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-192"><a href="#cb22-192"></a></span>
<span id="cb22-193"><a href="#cb22-193"></a><span class="co"># Data Cleaning</span></span>
<span id="cb22-194"><a href="#cb22-194"></a>resp_json_df <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">row_to_names</span>(resp_json_df, <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="co"># Move 1st row to Names</span></span>
<span id="cb22-195"><a href="#cb22-195"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="co"># Convert Matrix to Data Frame</span></span>
<span id="cb22-196"><a href="#cb22-196"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">'B'</span>), as.numeric)) <span class="co"># Convert all variables that start with B to numeric</span></span>
<span id="cb22-197"><a href="#cb22-197"></a></span>
<span id="cb22-198"><a href="#cb22-198"></a><span class="fu">head</span>(resp_json_df)</span>
<span id="cb22-199"><a href="#cb22-199"></a><span class="in">```</span></span>
<span id="cb22-200"><a href="#cb22-200"></a></span>
<span id="cb22-201"><a href="#cb22-201"></a>To learn more about JSON, consult the following readings:</span>
<span id="cb22-202"><a href="#cb22-202"></a></span>
<span id="cb22-203"><a href="#cb22-203"></a><span class="ss">1. </span><span class="co">[</span><span class="ot">A Non-Programmer's Introduction to JSON</span><span class="co">](https://blog.scottlowe.org/2013/11/08/a-non-programmers-introduction-to-json/)</span></span>
<span id="cb22-204"><a href="#cb22-204"></a><span class="ss">2. </span><span class="co">[</span><span class="ot">Getting Started With JSON and jsonlite</span><span class="co">](https://cran.r-project.org/web/packages/jsonlite/vignettes/json-aaquickstart.html)</span></span>
<span id="cb22-205"><a href="#cb22-205"></a><span class="ss">3. </span><span class="co">[</span><span class="ot">Fetching JSON data from REST APIs</span><span class="co">](https://cran.r-project.org/web/packages/jsonlite/vignettes/json-apis.html)</span></span>
<span id="cb22-206"><a href="#cb22-206"></a></span>
<span id="cb22-207"><a href="#cb22-207"></a></span>
<span id="cb22-208"><a href="#cb22-208"></a><span class="fu">## More API Examples</span></span>
<span id="cb22-209"><a href="#cb22-209"></a></span>
<span id="cb22-210"><a href="#cb22-210"></a><span class="fu">### Board Game Geek &amp; XML Data</span></span>
<span id="cb22-211"><a href="#cb22-211"></a></span>
<span id="cb22-212"><a href="#cb22-212"></a>The <span class="co">[</span><span class="ot">Board Game Geek API</span><span class="co">](https://boardgamegeek.com/wiki/page/BGG_XML_API2)</span> is referenced in the <span class="co">[</span><span class="ot">Games &amp; Comics</span><span class="co">](https://github.com/toddmotto/public-apis?tab=readme-ov-file#games--comics)</span> section of <span class="co">[</span><span class="ot">toddmotto's public API list</span><span class="co">](https://github.com/toddmotto/public-apis)</span>.</span>
<span id="cb22-213"><a href="#cb22-213"></a></span>
<span id="cb22-214"><a href="#cb22-214"></a>Our goal is to use the search API at the bottom of the page. </span>
<span id="cb22-215"><a href="#cb22-215"></a></span>
<span id="cb22-216"><a href="#cb22-216"></a>Let's start at the top of the API documentation page to see how to navigate this reference.</span>
<span id="cb22-217"><a href="#cb22-217"></a></span>
<span id="cb22-218"><a href="#cb22-218"></a><span class="ss">- </span>We can see from the XML references at the top that we will be expecting a new output format: XML stands for Extensible Markup Language</span>
<span id="cb22-219"><a href="#cb22-219"></a><span class="ss">- </span>The "Root Path" section tells us the base URL for the Board Game Geeks API endpoints and related APIs: <span class="ot">&lt;https://boardgamegeek.com/xmlapi2/&gt;</span></span>
<span id="cb22-220"><a href="#cb22-220"></a><span class="ss">- </span>The "Search" section at the bottom of the page tells us:</span>
<span id="cb22-221"><a href="#cb22-221"></a><span class="ss">    - </span>the path for the search endpoint (<span class="in">`/search`</span>)</span>
<span id="cb22-222"><a href="#cb22-222"></a><span class="ss">    - </span>what query parameters are possible</span>
<span id="cb22-223"><a href="#cb22-223"></a><span class="ss">    - </span>particular formatting instructions for query parameter values</span>
<span id="cb22-224"><a href="#cb22-224"></a></span>
<span id="cb22-225"><a href="#cb22-225"></a>The following request searches for board games, board game accessories, and board game expansions with the words "mystery" and "curse" in the title:</span>
<span id="cb22-226"><a href="#cb22-226"></a></span>
<span id="cb22-227"><a href="#cb22-227"></a><span class="in">```{r httr2_bgg}</span></span>
<span id="cb22-228"><a href="#cb22-228"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://boardgamegeek.com/xmlapi2"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-229"><a href="#cb22-229"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"search"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-230"><a href="#cb22-230"></a>    <span class="fu">req_url_query</span>(<span class="at">query =</span> <span class="fu">I</span>(<span class="st">"mystery+curse"</span>), <span class="at">type =</span> <span class="fu">I</span>(<span class="st">"boardgame,boardgameaccessory,boardgameexpansion"</span>))</span>
<span id="cb22-231"><a href="#cb22-231"></a><span class="in">```</span></span>
<span id="cb22-232"><a href="#cb22-232"></a></span>
<span id="cb22-233"><a href="#cb22-233"></a>When we use <span class="in">`req_perform()`</span>, we see from <span class="in">`Content-Type`</span> that the format of the response is something called XML. We can navigate to the request URL to see the structure of this output.</span>
<span id="cb22-234"><a href="#cb22-234"></a></span>
<span id="cb22-235"><a href="#cb22-235"></a><span class="ss">- </span>XML (Extensible Markup Language) is a tree structure of named nodes and attributes.</span>
<span id="cb22-236"><a href="#cb22-236"></a><span class="ss">- </span>We can use <span class="in">`resp_body_xml()`</span> to read in the XML as an R object.</span>
<span id="cb22-237"><a href="#cb22-237"></a></span>
<span id="cb22-238"><a href="#cb22-238"></a><span class="in">```{r bgg_response, eval=FALSE}</span></span>
<span id="cb22-239"><a href="#cb22-239"></a>resp <span class="ot">&lt;-</span> <span class="fu">req_perform</span>(req)</span>
<span id="cb22-240"><a href="#cb22-240"></a>resp</span>
<span id="cb22-241"><a href="#cb22-241"></a>resp <span class="ot">&lt;-</span> <span class="fu">resp_body_xml</span>(resp)</span>
<span id="cb22-242"><a href="#cb22-242"></a>resp</span>
<span id="cb22-243"><a href="#cb22-243"></a><span class="in">```</span></span>
<span id="cb22-244"><a href="#cb22-244"></a></span>
<span id="cb22-245"><a href="#cb22-245"></a>The XML output is not packaged in a nice way. (We'd love to have a data frame.) We can use the <span class="in">`xml2`</span> package to explore and navigate the XML structure to extract the information we need.</span>
<span id="cb22-246"><a href="#cb22-246"></a></span>
<span id="cb22-247"><a href="#cb22-247"></a>Let's first use the <span class="in">`xml_structure()`</span> function to see how information is organized:</span>
<span id="cb22-248"><a href="#cb22-248"></a></span>
<span id="cb22-249"><a href="#cb22-249"></a><span class="in">```{r xml_structure, eval = FALSE}</span></span>
<span id="cb22-250"><a href="#cb22-250"></a><span class="fu">xml_structure</span>(resp)</span>
<span id="cb22-251"><a href="#cb22-251"></a><span class="in">```</span></span>
<span id="cb22-252"><a href="#cb22-252"></a></span>
<span id="cb22-253"><a href="#cb22-253"></a>The key navigation and extraction functions in <span class="in">`xml2`</span> are:</span>
<span id="cb22-254"><a href="#cb22-254"></a></span>
<span id="cb22-255"><a href="#cb22-255"></a><span class="ss">- </span><span class="in">`xml_children()`</span>: Get nodes that are nested inside </span>
<span id="cb22-256"><a href="#cb22-256"></a><span class="ss">    - </span>Like getting the first level bullet points inside a given bullet point</span>
<span id="cb22-257"><a href="#cb22-257"></a><span class="ss">- </span><span class="in">`xml_find_all()`</span>: Finds nodes matching an XPath expression (XPath stands for XML path)</span>
<span id="cb22-258"><a href="#cb22-258"></a><span class="ss">    - </span>XPath expressions are like string regular expressions for XML trees</span>
<span id="cb22-259"><a href="#cb22-259"></a><span class="ss">    - </span>See <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.w3schools.com/xml/xpath_intro.asp)</span> for a deeper dive into XPath</span>
<span id="cb22-260"><a href="#cb22-260"></a><span class="ss">- </span><span class="in">`xml_attr()`</span>: Selects the value of an attribute (the information to the right of the <span class="in">`=`</span> in quotes)</span>
<span id="cb22-261"><a href="#cb22-261"></a><span class="ss">    - </span><span class="in">`&lt;node_name attribute_name1="attribute_value1" attribute_name2="attribute_value2"&gt;`</span></span>
<span id="cb22-262"><a href="#cb22-262"></a></span>
<span id="cb22-263"><a href="#cb22-263"></a><span class="in">```{r xml_nav_extract, eval=FALSE}</span></span>
<span id="cb22-264"><a href="#cb22-264"></a><span class="co"># Get the item nodes in 2 different ways</span></span>
<span id="cb22-265"><a href="#cb22-265"></a>resp <span class="sc">|&gt;</span> <span class="fu">xml_find_all</span>(<span class="st">"item"</span>)</span>
<span id="cb22-266"><a href="#cb22-266"></a>resp <span class="sc">|&gt;</span> <span class="fu">xml_children</span>()</span>
<span id="cb22-267"><a href="#cb22-267"></a></span>
<span id="cb22-268"><a href="#cb22-268"></a><span class="co"># Get the item "type"</span></span>
<span id="cb22-269"><a href="#cb22-269"></a>resp <span class="sc">|&gt;</span> <span class="fu">xml_find_all</span>(<span class="st">"item"</span>) <span class="sc">|&gt;</span> <span class="fu">xml_attr</span>(<span class="st">"type"</span>)</span>
<span id="cb22-270"><a href="#cb22-270"></a></span>
<span id="cb22-271"><a href="#cb22-271"></a><span class="co"># The &lt;name&gt; and &lt;yearpublished&gt; nodes are nested within each &lt;item&gt;</span></span>
<span id="cb22-272"><a href="#cb22-272"></a>resp <span class="sc">|&gt;</span> <span class="fu">xml_find_all</span>(<span class="st">"item/name"</span>)</span>
<span id="cb22-273"><a href="#cb22-273"></a>resp <span class="sc">|&gt;</span> <span class="fu">xml_find_all</span>(<span class="st">"item/yearpublished"</span>) <span class="co"># Notice that this is length 8 instead of 9!</span></span>
<span id="cb22-274"><a href="#cb22-274"></a></span>
<span id="cb22-275"><a href="#cb22-275"></a><span class="co"># Get the "primary" or "alternate" designation for each name</span></span>
<span id="cb22-276"><a href="#cb22-276"></a>resp <span class="sc">|&gt;</span> <span class="fu">xml_find_all</span>(<span class="st">"item/name"</span>) <span class="sc">|&gt;</span> <span class="fu">xml_attr</span>(<span class="st">"type"</span>)</span>
<span id="cb22-277"><a href="#cb22-277"></a><span class="in">```</span></span>
<span id="cb22-278"><a href="#cb22-278"></a></span>
<span id="cb22-279"><a href="#cb22-279"></a>**Exercises**</span>
<span id="cb22-280"><a href="#cb22-280"></a></span>
<span id="cb22-281"><a href="#cb22-281"></a><span class="ss">1. </span>Get the board game name (e.g., "Murder Mystery..." and  "Robinson Crusoe")</span>
<span id="cb22-282"><a href="#cb22-282"></a><span class="ss">2. </span>Get the board game ID number (e.g., 63495, 40175)</span>
<span id="cb22-283"><a href="#cb22-283"></a></span>
<span id="cb22-284"><a href="#cb22-284"></a><span class="at">&gt; This activity wasn't working. It seems to be a problem with the API</span></span>
<span id="cb22-285"><a href="#cb22-285"></a></span>
<span id="cb22-286"><a href="#cb22-286"></a><span class="fu">### New York Times API</span></span>
<span id="cb22-287"><a href="#cb22-287"></a></span>
<span id="cb22-288"><a href="#cb22-288"></a>This example will build on the <span class="co">[</span><span class="ot">New York Times Web API</span><span class="co">](https://developer.nytimes.com/)</span>, which provides access to news articles, movie reviews, book reviews, and many other data. </span>
<span id="cb22-289"><a href="#cb22-289"></a></span>
<span id="cb22-290"><a href="#cb22-290"></a>We will specifically focus on the <span class="co">[</span><span class="ot">Article Search API</span><span class="co">](https://developer.nytimes.com/docs/articlesearch-product/1/overview)</span>, which finds information about news articles that contain a particular word or phrase.</span>
<span id="cb22-291"><a href="#cb22-291"></a></span>
<span id="cb22-292"><a href="#cb22-292"></a>To get started with the NY Times API, you must <span class="co">[</span><span class="ot">register and get an **authentication key**</span><span class="co">](https://developer.nytimes.com/accounts/create)</span>. Signup only takes a few seconds, and it lets the New York Times make sure nobody abuses their API for commercial purposes. It also **rate limits** their API and ensures programs don't make too many requests per day. For the NY Times API, this limit is 1000 calls per day. </span>
<span id="cb22-293"><a href="#cb22-293"></a></span>
<span id="cb22-294"><a href="#cb22-294"></a>Once you have signed up, verified your email, log back in to https://developer.nytimes.com. Under your email address, click on Apps and Create a new App (call it First API) and enable Article Search API, then press Save. This creates an **authentication key**, which is a 32 digit string with numbers and the letters a-e. </span>
<span id="cb22-295"><a href="#cb22-295"></a></span>
<span id="cb22-296"><a href="#cb22-296"></a>As with your census API key, save this key in a <span class="in">`.txt`</span> file, and read it in and store this in a variable called <span class="in">`times_key`</span>.  üìå Again, don't commit this file to GitHub.  Make Git ignores it via GitHub Desktop (**Right click** the file --&gt; select **Ignore file (add to .gitignore)**.</span>
<span id="cb22-297"><a href="#cb22-297"></a></span>
<span id="cb22-298"><a href="#cb22-298"></a><span class="in">```{r nyt_key_2}</span></span>
<span id="cb22-299"><a href="#cb22-299"></a>times_key <span class="ot">&lt;-</span> <span class="fu">read_lines</span>(<span class="st">"times_key"</span>)</span>
<span id="cb22-300"><a href="#cb22-300"></a><span class="in">```</span></span>
<span id="cb22-301"><a href="#cb22-301"></a></span>
<span id="cb22-302"><a href="#cb22-302"></a></span>
<span id="cb22-303"><a href="#cb22-303"></a></span>
<span id="cb22-304"><a href="#cb22-304"></a>Open this URL in your browser (you should replace <span class="in">`MY_KEY`</span> with the API key you were given).</span>
<span id="cb22-305"><a href="#cb22-305"></a></span>
<span id="cb22-306"><a href="#cb22-306"></a><span class="in">    http://api.nytimes.com/svc/search/v2/articlesearch.json?q=gamergate&amp;api-key=MY_KEY</span></span>
<span id="cb22-307"><a href="#cb22-307"></a><span class="in">    </span></span>
<span id="cb22-308"><a href="#cb22-308"></a>The text you see in the browser is the response data (in JSON format). </span>
<span id="cb22-309"><a href="#cb22-309"></a></span>
<span id="cb22-310"><a href="#cb22-310"></a>This URL has the same structure that we discussed above for the census API:</span>
<span id="cb22-311"><a href="#cb22-311"></a></span>
<span id="cb22-312"><a href="#cb22-312"></a><span class="ss">- </span><span class="in">`http://`</span> --- The **scheme**, which tells your browser or program how to communicate with the web server. This will typically be either <span class="in">`http:`</span> or <span class="in">`https:`</span>.</span>
<span id="cb22-313"><a href="#cb22-313"></a><span class="ss">- </span><span class="in">`api.nytimes.com`</span> --- The **hostname**, which is a name that identifies the web server that will process the request.</span>
<span id="cb22-314"><a href="#cb22-314"></a><span class="ss">- </span><span class="in">`/svc/search/v2/articlesearch.json`</span> --- The **path**, which tells the web server what function you would like to call (a function for searching articles).</span>
<span id="cb22-315"><a href="#cb22-315"></a><span class="ss">- </span><span class="in">`?q=gamergate&amp;api-key=MY_KEY`</span> --- The **query parameters**, which provide the parameters for the function you would like to call. The key value pairs are the following:</span>
<span id="cb22-316"><a href="#cb22-316"></a></span>
<span id="cb22-317"><a href="#cb22-317"></a>key      value</span>
<span id="cb22-318"><a href="#cb22-318"></a>----     ------</span>
<span id="cb22-319"><a href="#cb22-319"></a>q        gamergate</span>
<span id="cb22-320"><a href="#cb22-320"></a>api-key  MY_KEY</span>
<span id="cb22-321"><a href="#cb22-321"></a></span>
<span id="cb22-322"><a href="#cb22-322"></a>The scheme, hostname, and path (<span class="in">`http://api.nytimes.com/svc/search/v2/articlesearch.json`</span>) together form the **[endpoint](https://en.wikipedia.org/wiki/Web_API#Endpoints)** for the API call.</span>
<span id="cb22-323"><a href="#cb22-323"></a></span>
<span id="cb22-324"><a href="#cb22-324"></a>We can use the <span class="in">`httr2`</span> package to build up a full URL from its parts:</span>
<span id="cb22-325"><a href="#cb22-325"></a></span>
<span id="cb22-326"><a href="#cb22-326"></a><span class="in">```{r httr2_nyt}</span></span>
<span id="cb22-327"><a href="#cb22-327"></a>req <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"http://api.nytimes.com"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-328"><a href="#cb22-328"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"svc"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-329"><a href="#cb22-329"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"search"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-330"><a href="#cb22-330"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"v2"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-331"><a href="#cb22-331"></a>    <span class="fu">req_url_path_append</span>(<span class="st">"articlesearch.json"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-332"><a href="#cb22-332"></a>    <span class="fu">req_url_query</span>(<span class="at">q =</span> <span class="st">"gamergate"</span>, <span class="st">`</span><span class="at">api-key</span><span class="st">`</span> <span class="ot">=</span> times_key)</span>
<span id="cb22-333"><a href="#cb22-333"></a><span class="in">```</span></span>
<span id="cb22-334"><a href="#cb22-334"></a></span>
<span id="cb22-335"><a href="#cb22-335"></a></span>
<span id="cb22-336"><a href="#cb22-336"></a>We can write a function to generate the URL for a user-specified query:</span>
<span id="cb22-337"><a href="#cb22-337"></a></span>
<span id="cb22-338"><a href="#cb22-338"></a><span class="in">```{r create_nyt_url}</span></span>
<span id="cb22-339"><a href="#cb22-339"></a>create_nyt_url <span class="ot">&lt;-</span> <span class="cf">function</span>(query, key) {</span>
<span id="cb22-340"><a href="#cb22-340"></a>    <span class="fu">request</span>(<span class="st">"http://api.nytimes.com"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-341"><a href="#cb22-341"></a>        <span class="fu">req_url_path_append</span>(<span class="st">"svc"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-342"><a href="#cb22-342"></a>        <span class="fu">req_url_path_append</span>(<span class="st">"search"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-343"><a href="#cb22-343"></a>        <span class="fu">req_url_path_append</span>(<span class="st">"v2"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-344"><a href="#cb22-344"></a>        <span class="fu">req_url_path_append</span>(<span class="st">"articlesearch.json"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-345"><a href="#cb22-345"></a>        <span class="fu">req_url_query</span>(<span class="at">q =</span> query, <span class="st">`</span><span class="at">api-key</span><span class="st">`</span> <span class="ot">=</span> key)</span>
<span id="cb22-346"><a href="#cb22-346"></a>}</span>
<span id="cb22-347"><a href="#cb22-347"></a><span class="in">```</span></span>
<span id="cb22-348"><a href="#cb22-348"></a></span>
<span id="cb22-349"><a href="#cb22-349"></a>Let's use this function to find articles related to:</span>
<span id="cb22-350"><a href="#cb22-350"></a></span>
<span id="cb22-351"><a href="#cb22-351"></a><span class="ss">- </span><span class="in">`Ferris Bueller's Day Off`</span> (note the spaces and the apostrophe)</span>
<span id="cb22-352"><a href="#cb22-352"></a><span class="ss">- </span><span class="in">`Penn &amp; Teller`</span> (note the spaces and the punctuation mark <span class="in">`&amp;`</span>)</span>
<span id="cb22-353"><a href="#cb22-353"></a></span>
<span id="cb22-354"><a href="#cb22-354"></a>Let's see how these queries are translated into the URLs:</span>
<span id="cb22-355"><a href="#cb22-355"></a></span>
<span id="cb22-356"><a href="#cb22-356"></a><span class="in">```{r use_create_nyt_url}</span></span>
<span id="cb22-357"><a href="#cb22-357"></a>req_fb <span class="ot">&lt;-</span> <span class="fu">create_nyt_url</span>(<span class="at">query =</span> <span class="st">"Ferris Bueller's Day Off"</span>, <span class="at">key =</span> times_key)</span>
<span id="cb22-358"><a href="#cb22-358"></a>req_pt <span class="ot">&lt;-</span> <span class="fu">create_nyt_url</span>(<span class="at">query =</span> <span class="st">"Penn &amp; Teller"</span>, <span class="at">key =</span> times_key)</span>
<span id="cb22-359"><a href="#cb22-359"></a><span class="in">```</span></span>
<span id="cb22-360"><a href="#cb22-360"></a></span>
<span id="cb22-361"><a href="#cb22-361"></a>We can use <span class="in">`req_perform()`</span> to send out the request and <span class="in">`resp_body_json()`</span> to parse the resulting JSON:</span>
<span id="cb22-362"><a href="#cb22-362"></a></span>
<span id="cb22-363"><a href="#cb22-363"></a><span class="in">```{r nyt_responses}</span></span>
<span id="cb22-364"><a href="#cb22-364"></a><span class="co">#resp_pt &lt;- req_pt |&gt; req_perform() |&gt; resp_body_json(simplifyVector = TRUE)</span></span>
<span id="cb22-365"><a href="#cb22-365"></a><span class="in">```</span></span>
<span id="cb22-366"><a href="#cb22-366"></a></span>
<span id="cb22-367"><a href="#cb22-367"></a></span>
<span id="cb22-368"><a href="#cb22-368"></a><span class="fu">#### Exploring complex lists</span></span>
<span id="cb22-369"><a href="#cb22-369"></a></span>
<span id="cb22-370"><a href="#cb22-370"></a><span class="in">`resp_pt`</span> is a **list**. A list is a useful structure for storing elements of different types. Data frames are special cases of lists where each list element has the same length (but where the list elements have different classes).</span>
<span id="cb22-371"><a href="#cb22-371"></a></span>
<span id="cb22-372"><a href="#cb22-372"></a>Lists are a very flexible data structure but can be very confusing because list elements can be lists themselves!</span>
<span id="cb22-373"><a href="#cb22-373"></a></span>
<span id="cb22-374"><a href="#cb22-374"></a>We can explore the structure of a list in two ways:</span>
<span id="cb22-375"><a href="#cb22-375"></a></span>
<span id="cb22-376"><a href="#cb22-376"></a><span class="ss">- </span>Entering <span class="in">`View(list_object)`</span> in the Console. The triangle buttons on the left allow you to toggle dropdowns to explore list elements.</span>
<span id="cb22-377"><a href="#cb22-377"></a><span class="ss">- </span>Using the <span class="in">`str()`</span> (structure) function.</span>
<span id="cb22-378"><a href="#cb22-378"></a></span>
<span id="cb22-379"><a href="#cb22-379"></a></span>
<span id="cb22-380"><a href="#cb22-380"></a>Using base R subsetting, we can access elements of a list in three ways:</span>
<span id="cb22-381"><a href="#cb22-381"></a></span>
<span id="cb22-382"><a href="#cb22-382"></a><span class="ss">- </span>By *position* with double square brackets <span class="in">`[[`</span>:</span>
<span id="cb22-383"><a href="#cb22-383"></a></span>
<span id="cb22-384"><a href="#cb22-384"></a><span class="in">```{r list_access1}</span></span>
<span id="cb22-385"><a href="#cb22-385"></a><span class="co"># This gets the first element of the list</span></span>
<span id="cb22-386"><a href="#cb22-386"></a><span class="co"># resp_pt[[1]]</span></span>
<span id="cb22-387"><a href="#cb22-387"></a><span class="in">```</span></span>
<span id="cb22-388"><a href="#cb22-388"></a></span>
<span id="cb22-389"><a href="#cb22-389"></a></span>
<span id="cb22-390"><a href="#cb22-390"></a><span class="ss">- </span>By *name* with double square brackets <span class="in">`[[`</span>: (note that list elements are not always named, so this won't always be possible)</span>
<span id="cb22-391"><a href="#cb22-391"></a></span>
<span id="cb22-392"><a href="#cb22-392"></a><span class="in">```{r list_access2}</span></span>
<span id="cb22-393"><a href="#cb22-393"></a><span class="co"># # Accessing by name directly</span></span>
<span id="cb22-394"><a href="#cb22-394"></a><span class="co"># resp_pt[["status"]]</span></span>
<span id="cb22-395"><a href="#cb22-395"></a><span class="co"># </span></span>
<span id="cb22-396"><a href="#cb22-396"></a><span class="co"># # Accessing via a variable</span></span>
<span id="cb22-397"><a href="#cb22-397"></a><span class="co"># which_element &lt;- "status"</span></span>
<span id="cb22-398"><a href="#cb22-398"></a><span class="co"># resp_pt[[which_element]]</span></span>
<span id="cb22-399"><a href="#cb22-399"></a><span class="in">```</span></span>
<span id="cb22-400"><a href="#cb22-400"></a></span>
<span id="cb22-401"><a href="#cb22-401"></a><span class="ss">- </span>By *name* with a dollar sign <span class="in">`$`</span>: (Helpful tip: For this mode of access, RStudio allows tab completion to fill in the full name)</span>
<span id="cb22-402"><a href="#cb22-402"></a></span>
<span id="cb22-403"><a href="#cb22-403"></a><span class="in">```{r list_access3}</span></span>
<span id="cb22-404"><a href="#cb22-404"></a><span class="co"># resp_pt$status</span></span>
<span id="cb22-405"><a href="#cb22-405"></a><span class="in">```</span></span>
<span id="cb22-406"><a href="#cb22-406"></a></span>
<span id="cb22-407"><a href="#cb22-407"></a>We can retrieve these *nested* attributes by sequentially accessing the object keys from the outside in. For example, the <span class="in">`meta`</span> element would be accessed as follows:</span>
<span id="cb22-408"><a href="#cb22-408"></a></span>
<span id="cb22-409"><a href="#cb22-409"></a><span class="in">```{r list_access4}</span></span>
<span id="cb22-410"><a href="#cb22-410"></a><span class="co"># resp_pt$response$meta</span></span>
<span id="cb22-411"><a href="#cb22-411"></a><span class="in">```</span></span>
<span id="cb22-412"><a href="#cb22-412"></a></span>
<span id="cb22-413"><a href="#cb22-413"></a></span>
<span id="cb22-414"><a href="#cb22-414"></a>**Exercise:** In the <span class="in">`resp_pt`</span> object, retrieve the data associated with:</span>
<span id="cb22-415"><a href="#cb22-415"></a></span>
<span id="cb22-416"><a href="#cb22-416"></a><span class="ss">- </span>the <span class="in">`copyright`</span> key</span>
<span id="cb22-417"><a href="#cb22-417"></a><span class="ss">- </span>the number of <span class="in">`hits`</span> (number of search results) within the <span class="in">`meta`</span> object</span>
<span id="cb22-418"><a href="#cb22-418"></a><span class="ss">- </span>the abstracts and leading paragraphs of the articles found in the search</span>
<span id="cb22-421"><a href="#cb22-421"></a><span class="in">```{r}</span></span>
<span id="cb22-422"><a href="#cb22-422"></a><span class="co"># resp_pt$copyright</span></span>
<span id="cb22-423"><a href="#cb22-423"></a><span class="co"># </span></span>
<span id="cb22-424"><a href="#cb22-424"></a><span class="co"># resp_pt$response$meta$hits</span></span>
<span id="cb22-425"><a href="#cb22-425"></a><span class="co"># </span></span>
<span id="cb22-426"><a href="#cb22-426"></a><span class="co"># resp_pt$response$docs$abstract</span></span>
<span id="cb22-427"><a href="#cb22-427"></a><span class="co"># resp_pt$response$docs$lead_paragraph</span></span>
<span id="cb22-428"><a href="#cb22-428"></a><span class="in">```</span></span>
<span id="cb22-429"><a href="#cb22-429"></a></span>
<span id="cb22-430"><a href="#cb22-430"></a></span>
<span id="cb22-431"><a href="#cb22-431"></a><span class="fu">## Done!</span></span>
<span id="cb22-432"><a href="#cb22-432"></a></span>
<span id="cb22-433"><a href="#cb22-433"></a><span class="ss">- </span>Check the ICA Instructions for how to (a) push your code to GitHub and (b) update your portfolio website</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>