<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>16 Databases and SQL ‚Äì COMP/STAT212 Portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../src/ica/18-interactive-viz-notes.html" rel="next">
<link href="../../src/ica/15-scraping-notes.html" rel="prev">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-b6165e882820e9cbe81d0573c00a9ad9.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-336fc07c9e36db0483797e7526239151.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-b6165e882820e9cbe81d0573c00a9ad9.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="../../style/custom.css">
</head>

<body class="nav-sidebar docked quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../src/ica/cleaning.html">In-Class Activities</a></li><li class="breadcrumb-item"><a href="../../src/ica/16-databases-notes.html"><span class="chapter-title">16 Databases and SQL</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../assets/sidebar-logo.png" alt="Random negative space illustration" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Nico Thorn</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Prof Viz</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/pv/pv-01.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Professional Viz</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">TidyTuesday</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/tt/hw01-tt.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Homework 01</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/tt/2025-07-08.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">TidyTuesday Sample 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/tt/2025-07-15.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">TidyTuesday Sample 2</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">In-Class Activities</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/cleaning.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Cleaning SFO Weather Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/03-adv-ggplot-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3 Advanced Data Viz</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/04-adv-maps-1-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4 Advanced Spatial Viz P1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/06-wrangling-1-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">6 Adv Data wrangling P1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/07-wrangling-2-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">7 Adv Data wrangling P2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/08-missing-data-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">8 Missing Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/09-functions-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">9 Functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/10-base-r-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">10 Base R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/11-iteration-1-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">11 Loops+Iter P1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/12-iteration-2-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">12 Loops+Iter P2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/14-apis-2-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">14 APIs P2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/15-scraping-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">15 Web scraping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/16-databases-notes.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">16 Databases and SQL</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/ica/18-interactive-viz-notes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">18 Interactive Viz</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/appx/appx-sample1.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix Sample 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/appx/appx-sample2.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Appendix Sample 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mm/mm.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Mind Maps</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-goals" id="toc-learning-goals" class="nav-link active" data-scroll-target="#learning-goals">üß© Learning Goals</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#connecting-to-a-database-in-r-with-dbi" id="toc-connecting-to-a-database-in-r-with-dbi" class="nav-link" data-scroll-target="#connecting-to-a-database-in-r-with-dbi">Connecting to a database in R with <code>DBI</code></a></li>
  <li><a href="#what-is-sql" id="toc-what-is-sql" class="nav-link" data-scroll-target="#what-is-sql">What is SQL?</a></li>
  <li><a href="#sql-with-dplyr" id="toc-sql-with-dplyr" class="nav-link" data-scroll-target="#sql-with-dplyr">SQL with <code>dplyr</code></a></li>
  <li><a href="#sql-practice" id="toc-sql-practice" class="nav-link" data-scroll-target="#sql-practice">SQL Practice</a>
  <ul class="collapse">
  <li><a href="#stack-exchange-data-explorer" id="toc-stack-exchange-data-explorer" class="nav-link" data-scroll-target="#stack-exchange-data-explorer">Stack Exchange Data Explorer</a></li>
  <li><a href="#instructions" id="toc-instructions" class="nav-link" data-scroll-target="#instructions">Instructions</a></li>
  <li><a href="#select-queries" id="toc-select-queries" class="nav-link" data-scroll-target="#select-queries">Select Queries</a></li>
  <li><a href="#sql-summarization" id="toc-sql-summarization" class="nav-link" data-scroll-target="#sql-summarization">SQL Summarization</a></li>
  <li><a href="#sql-joins" id="toc-sql-joins" class="nav-link" data-scroll-target="#sql-joins">SQL Joins</a></li>
  </ul></li>
  <li><a href="#going-beyond" id="toc-going-beyond" class="nav-link" data-scroll-target="#going-beyond">Going Beyond</a>
  <ul class="collapse">
  <li><a href="#exploring-cloud-dbmss" id="toc-exploring-cloud-dbmss" class="nav-link" data-scroll-target="#exploring-cloud-dbmss">Exploring cloud DBMS‚Äôs</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../src/ica/cleaning.html">In-Class Activities</a></li><li class="breadcrumb-item"><a href="../../src/ica/16-databases-notes.html"><span class="chapter-title">16 Databases and SQL</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-title">16 Databases and SQL</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<section id="learning-goals" class="level2">
<h2 class="anchored" data-anchor-id="learning-goals">üß© Learning Goals</h2>
<p>By the end of this lesson, you should be able to: - Develop comfort in composing SQL queries - See the connections between <code>tidyverse</code> verbs and SQL clauses</p>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>If you find yourself analyzing data within a medium or large organization, you will probably draw on data stored within a centralized <a href="https://en.wikipedia.org/wiki/Data_warehouse">data warehouse</a>.</p>
<p>Data warehouses contain vast collections of information‚Äìfar more than a desktop or laptop computer can easily analyze.</p>
<p>These warehouses typically rely on structured data repositories called <strong>relational databases</strong> (also often called <strong>SQL databases</strong>).</p>
<p>Relational databases store data in <strong>tables</strong>, which are structured with rows and columns (attributes). Tables can be joined using <strong>keys</strong> which uniquely identify a row within a table.</p>
</section>
<section id="connecting-to-a-database-in-r-with-dbi" class="level2">
<h2 class="anchored" data-anchor-id="connecting-to-a-database-in-r-with-dbi">Connecting to a database in R with <code>DBI</code></h2>
<p>The <code>DBI</code> package (<strong>d</strong>ata<strong>b</strong>ase <strong>i</strong>nterface) provides general tools for interacting with databases from R.</p>
<ul>
<li>It is also common for data scientists to interact with databases directly by writing SQL queries. We‚Äôll talk about this in the next section.</li>
</ul>
<p>For now, we‚Äôll use <code>DBI</code> to connect with an <strong>in-process</strong> database (<code>duckdb</code>), one that runs locally on your computer.</p>
<ul>
<li>A nice feature of <code>duckdb</code> is that even if your dataset is huge, <code>duckdb</code> can work with it very quickly.</li>
</ul>
<p>We can set up a database connection with <code>dbConnect()</code> and initialize a temporary database with <code>duckdb()</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>con <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>())</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">class</span>(con)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "duckdb_connection"
attr(,"package")
[1] "duckdb"</code></pre>
</div>
</div>
<p>In a real project, we would use <code>duckdb_read_csv()</code> to store data directly into the <code>duckdb</code> database without first having to read it into R.</p>
<p>In the toy example below, we have a dataset on Spotify songs (<code>all_spotify_songs.csv</code>) and store in a database table called <code>"songs"</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">duckdb_read_csv</span>(con, <span class="st">"songs"</span>, <span class="st">"https://hash-mac.github.io/stat212site-f25/relative/path/to/all_spotify_songs.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here, we‚Äôll use datasets from the <code>nycflights13</code> package.</p>
<p>The <code>DBI</code> package provides the <code>dbWriteTable()</code> function to write dataset objects (in constrast to csv files) to a database:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">dbWriteTable</span>(con, <span class="st">"flights"</span>, nycflights13<span class="sc">::</span>flights)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">dbWriteTable</span>(con, <span class="st">"planes"</span>, nycflights13<span class="sc">::</span>planes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can use <code>tbl()</code>, short for table, to create connections individually to the <code>flights</code> and <code>planes</code> datasets.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>flights <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"flights"</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a>planes <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"planes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note that the results of <code>tbl()</code> are not quite the same as our normal data frames.</p>
<p>Although they have class <code>tbl</code>, note that the number of rows is <code>NA</code>!</p>
<p>The full dataset isn‚Äôt loaded into memory when we use <code>tbl</code>, so the number of rows is unknown. This behavior is purposeful‚Äìit reduces computer resources and allows access to parts of the data only when needed.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">class</span>(flights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_duckdb_connection" "tbl_dbi"               "tbl_sql"              
[4] "tbl_lazy"              "tbl"                  </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">dim</span>(flights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA 19</code></pre>
</div>
</div>
</section>
<section id="what-is-sql" class="level2">
<h2 class="anchored" data-anchor-id="what-is-sql">What is SQL?</h2>
<p>SQL stands for Structured Query Language.</p>
<p>It is a programming language to query or retrieve data from a relational database.</p>
</section>
<section id="sql-with-dplyr" class="level2">
<h2 class="anchored" data-anchor-id="sql-with-dplyr">SQL with <code>dplyr</code></h2>
<p>A really nice feature of <code>dplyr</code> is that we can write R code for wrangling the data and use <code>show_query()</code> to translate that code into SQL.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>flights <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>    <span class="fu">show_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT *
FROM flights</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>flights <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>    <span class="fu">mutate</span>(<span class="at">full_date =</span> <span class="fu">str_c</span>(year, month, day, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>    <span class="fu">show_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT flights.*, CONCAT_WS('-', "year", "month", "day") AS full_date
FROM flights</code></pre>
</div>
</div>
<p><strong>Explore:</strong> Create a Google Document and share it with the people at your table. Using the code examples below, work with your group to co-create a <code>dplyr</code>&lt;-&gt; SQL translation guide (notes document) that allows you to answer the following:</p>
<ul>
<li>What do <code>SELECT</code>, <code>FROM</code>, <code>WHERE</code>, <code>GROUP BY</code>, and <code>ORDER BY</code> in SQL do? (These uppercase words are called <strong>clauses</strong> in SQL.)
<ul>
<li>How do these clauses translate to the main <code>tidyverse</code> verbs <code>select</code>, <code>mutate</code>, <code>filter</code>, <code>arrange</code>, <code>summarize</code>, <code>group_by</code>?</li>
</ul></li>
<li>What syntax differences are there for logical comparisons?
<ul>
<li>How do the <code>&amp;</code> and <code>|</code> logical operators in R compare to SQL?</li>
</ul></li>
<li>How does the R syntax for <code>mutate</code> translate to SQL?</li>
<li>How does joining datasets seem to work in SQL?</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2"></a>    <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"IAH"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="fu">arrange</span>(dep_delay) <span class="sc">|&gt;</span> </span>
<span id="cb14-4"><a href="#cb14-4"></a>    <span class="fu">show_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT flights.*
FROM flights
WHERE (dest = 'IAH')
ORDER BY dep_delay</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2"></a>    <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"IAH"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href="#cb16-3"></a>    <span class="fu">arrange</span>(dep_delay) <span class="sc">|&gt;</span> </span>
<span id="cb16-4"><a href="#cb16-4"></a>    <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb16-5"><a href="#cb16-5"></a>    <span class="fu">show_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT flights.*
FROM flights
WHERE (dest = 'IAH')
ORDER BY dep_delay
LIMIT 10</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2"></a>    <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"IAH"</span> <span class="sc">&amp;</span> origin <span class="sc">==</span> <span class="st">"JFK"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3"></a>    <span class="fu">arrange</span>(dep_delay) <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a href="#cb18-4"></a>    <span class="fu">show_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT flights.*
FROM flights
WHERE (dest = 'IAH' AND origin = 'JFK')
ORDER BY dep_delay</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2"></a>    <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"IAH"</span> <span class="sc">|</span> origin <span class="sc">==</span> <span class="st">"JFK"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb20-3"><a href="#cb20-3"></a>    <span class="fu">arrange</span>(year, month, day, <span class="fu">desc</span>(dep_delay)) <span class="sc">|&gt;</span> </span>
<span id="cb20-4"><a href="#cb20-4"></a>    <span class="fu">show_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT flights.*
FROM flights
WHERE (dest = 'IAH' OR origin = 'JFK')
ORDER BY "year", "month", "day", dep_delay DESC</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2"></a>    <span class="fu">filter</span>(dest <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"IAH"</span>, <span class="st">"HOU"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb22-3"><a href="#cb22-3"></a>    <span class="fu">show_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT flights.*
FROM flights
WHERE (dest IN ('IAH', 'HOU'))</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(dep_delay)) <span class="sc">|&gt;</span> </span>
<span id="cb24-3"><a href="#cb24-3"></a>    <span class="fu">show_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT flights.*
FROM flights
WHERE (NOT((dep_delay IS NULL)))</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>planes <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a href="#cb26-2"></a>    <span class="fu">select</span>(tailnum, type, manufacturer, model, year) <span class="sc">|&gt;</span> </span>
<span id="cb26-3"><a href="#cb26-3"></a>    <span class="fu">show_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT tailnum, "type", manufacturer, model, "year"
FROM planes</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>planes <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2"></a>    <span class="fu">select</span>(tailnum, type, manufacturer, model, year) <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3"></a>    <span class="fu">rename</span>(<span class="at">year_built =</span> year) <span class="sc">|&gt;</span> </span>
<span id="cb28-4"><a href="#cb28-4"></a>    <span class="fu">show_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT tailnum, "type", manufacturer, model, "year" AS year_built
FROM planes</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2"></a>    <span class="fu">mutate</span>(</span>
<span id="cb30-3"><a href="#cb30-3"></a>        <span class="at">speed =</span> distance <span class="sc">/</span> (air_time <span class="sc">/</span> <span class="dv">60</span>)</span>
<span id="cb30-4"><a href="#cb30-4"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb30-5"><a href="#cb30-5"></a>    <span class="fu">show_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT flights.*, distance / (air_time / 60.0) AS speed
FROM flights</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2"></a>    <span class="fu">left_join</span>(planes, <span class="at">by =</span> <span class="st">"tailnum"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-3"><a href="#cb32-3"></a>    <span class="fu">show_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT
  flights."year" AS "year.x",
  "month",
  "day",
  dep_time,
  sched_dep_time,
  dep_delay,
  arr_time,
  sched_arr_time,
  arr_delay,
  carrier,
  flight,
  flights.tailnum AS tailnum,
  origin,
  dest,
  air_time,
  distance,
  "hour",
  "minute",
  time_hour,
  planes."year" AS "year.y",
  "type",
  manufacturer,
  model,
  engines,
  seats,
  speed,
  engine
FROM flights
LEFT JOIN planes
  ON (flights.tailnum = planes.tailnum)</code></pre>
</div>
</div>
</section>
<section id="sql-practice" class="level2">
<h2 class="anchored" data-anchor-id="sql-practice">SQL Practice</h2>
<section id="stack-exchange-data-explorer" class="level3">
<h3 class="anchored" data-anchor-id="stack-exchange-data-explorer">Stack Exchange Data Explorer</h3>
<p>We will experiment with the <a href="https://data.stackexchange.com/">Stack Exchange Data Explorer</a>, a website that provides a SQL interface for all the data in StackExchange.</p>
<p>StackExchange powers the StackOverflow programming question and answer site, but it also powers question and answer sites related to <a href="https://stackexchange.com/sites?view=grid">126 topics</a> including <a href="https://english.stackexchange.com/">English</a>, <a href="https://travel.stackexchange.com/">Travel</a>, <a href="https://bicycles.stackexchange.com/">Bicycles</a>, and <a href="https://parenting.stackexchange.com/">Parenting</a>.</p>
<p>StackExchange provides an in-depth <a href="https://data.stackexchange.com/help">Data Explorer Tutorial</a>. We start with this interface to construct SQL queries on the <a href="https://data.stackexchange.com/travel/queries">Travel Data Explorer</a>.</p>
</section>
<section id="instructions" class="level3">
<h3 class="anchored" data-anchor-id="instructions">Instructions</h3>
<p>Head to the <a href="https://data.stackexchange.com/travel/queries">Stack Exchange Data Explorer for Travel</a>.</p>
<p>You will see a list of queries other users have created in the past. These queries are for all Stack Exchange sites, so some may not be relevant. Queries about <em>your</em> activity (for example, ‚ÄúHow many upvotes do I have for each tag?‚Äù) will not be useful either if you do not have activity for the particular site.</p>
<p>Click on one of them and you see the SQL code for the query.</p>
<p>Then click the ‚ÄúRun Query‚Äù button to get results.</p>
<p>For example, you might look at the number of <a href="https://data.stackexchange.com/travel/query/1718/up-vs-down-votes-by-day-of-week-of-question-or-answer">up vs down votes for questions and answers by weekday</a> and notice that for questions, Tuesday has the highest up vs.&nbsp;down vote ratio and Saturday has the lowest. You can contemplate hypotheses for this difference!</p>
</section>
<section id="select-queries" class="level3">
<h3 class="anchored" data-anchor-id="select-queries">Select Queries</h3>
<p>Let‚Äôs experiment with our own queries.</p>
<p>Click on ‚ÄúCompose Query‚Äù in the upper right, and notice the tables are shown in the right.</p>
<p>As a reminder, a table is similar to a data frame.</p>
<ul>
<li>Each table lists the columns stored within the table and the data types for the columns.</li>
<li>Look through the tables for Posts, Users, and Comments.</li>
<li>Do the columns generally make sense, and correspond to the StackOverflow website?</li>
</ul>
<p>There‚Äôs a <a href="https://meta.stackexchange.com/a/2678">description of the tables and columns</a> (called a schema) available on StackExchange‚Äôs Meta Q&amp;A Site.</p>
<p>Now enter your first query in the text box and click the ‚ÄúRun Query‚Äù button:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb34-1"><a href="#cb34-1"></a><span class="kw">SELECT</span> TOP(<span class="dv">100</span>) <span class="kw">Id</span>, Title, Score, <span class="kw">Body</span>, Tags</span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="kw">FROM</span> Posts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In this query we already see several important features of SQL:</p>
<ul>
<li><code>SELECT</code> tells SQL that a query is coming.</li>
<li><code>TOP(100)</code> only returns the first 100 rows.
<ul>
<li>Note: The StackExchange data explorer uses a variant of SQL called <a href="https://en.wikipedia.org/wiki/Transact-SQL">Transact SQL</a> that is supported by Microsoft databases. <code>TOP(100)</code> is a non-standard SQL feature supported by T-SQL. For most databases you would accomplish the same goal by adding <code>LIMIT 100</code> to the end of the query.</li>
</ul></li>
<li><code>Id, Title, Score, Body, Tags</code> determines what columns are included in the result</li>
<li><code>FROM Posts</code> determines the source dataset.</li>
</ul>
<p>From glancing at the results, it appears that this table contains both questions and answers.</p>
<p>Let‚Äôs try to focus on answers.</p>
<p>Looking again at the <a href="https://meta.stackexchange.com/a/2678">Schema Description</a>, notice that there is a <code>PostTypeId</code> column in <code>Posts</code>, and a value of <code>1</code> corresponds to questions.</p>
<p>Let‚Äôs update our query to only include questions:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw">SELECT</span> TOP(<span class="dv">100</span>)</span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="kw">Id</span>, Title, Score, <span class="kw">Body</span>, Tags</span>
<span id="cb35-3"><a href="#cb35-3"></a><span class="kw">FROM</span> Posts</span>
<span id="cb35-4"><a href="#cb35-4"></a><span class="kw">WHERE</span> PostTypeId <span class="op">=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The SQL command <code>WHERE</code> is like the <code>filter</code> command we have been using in <code>dplyr</code>.</p>
<ul>
<li>Note that whereas we used the double equals <code>==</code> for comparison in <code>R</code>, the SQL <code>WHERE</code> command takes just a single <code>=</code>.</li>
</ul>
<p><strong>Exercise:</strong> Find the title and score of Posts that have a score of at least 110. <em>Hint: TOP is not necessary here because you want all result rows.</em></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb36-1"><a href="#cb36-1"></a><span class="kw">SELECT</span> </span>
<span id="cb36-2"><a href="#cb36-2"></a>Title, Score </span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="kw">FROM</span> Posts </span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="kw">WHERE</span> SCORE <span class="op">&gt;=</span> <span class="dv">110</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Exercise:</strong> Find posts whose title contains some place you are interested in (you pick!). <em>Hint: use SQL‚Äôs <a href="http://www.sqltutorial.org/sql-like/">LIKE operator</a>.</em></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb37-1"><a href="#cb37-1"></a><span class="kw">SELECT</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>Title</span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="kw">FROM</span> Posts</span>
<span id="cb37-4"><a href="#cb37-4"></a><span class="kw">WHERE</span> Title <span class="kw">LIKE</span> <span class="st">'%Berlin%'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note that you can look up the actual webpage for any question using its <code>Id</code>.</p>
<p>For example, if the <code>Id</code> is 19591, the webpage <a href="https://en.wikipedia.org/wiki/URL">URL</a> would be <a href="https://travel.stackexchange.com/questions/19591/" class="uri">https://travel.stackexchange.com/questions/19591/</a>. Look up a few of the questions by their <code>Id</code>.</p>
<p>It‚Äôs unclear how the 100 questions we saw were selected from among the over 43,000 total questions.</p>
<ul>
<li>To count the number of posts, we can use <code>COUNT</code> in SQL: <code>SELECT COUNT(Id) FROM Posts Where PostTypeId = 1</code>.</li>
</ul>
<p>Let‚Äôs try to arrange the Posts by score.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb38-1"><a href="#cb38-1"></a><span class="kw">SELECT</span> TOP(<span class="dv">100</span>)</span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="kw">Id</span>, Title, Score, <span class="kw">Body</span>, Tags</span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="kw">FROM</span> Posts</span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="kw">WHERE</span> PostTypeId <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb38-5"><a href="#cb38-5"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Score <span class="kw">DESC</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The <code>ORDER BY ??? DESC</code> syntax is similar to R‚Äôs <code>arrange()</code>. You can leave off the <code>DESC</code> if you want the results ordered smallest to largest.</p>
<p>We could also find the <a href="https://travel.stackexchange.com/questions/tagged/italy">highest rated questions tagged ‚Äúitaly‚Äù</a>:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb39-1"><a href="#cb39-1"></a><span class="kw">SELECT</span> TOP(<span class="dv">100</span>)</span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="kw">Id</span>, Title, Score, <span class="kw">Body</span>, Tags</span>
<span id="cb39-3"><a href="#cb39-3"></a><span class="kw">FROM</span> Posts</span>
<span id="cb39-4"><a href="#cb39-4"></a><span class="kw">WHERE</span> PostTypeId <span class="op">=</span> <span class="dv">1</span> <span class="kw">AND</span> Tags <span class="kw">LIKE</span> <span class="st">'%italy%'</span></span>
<span id="cb39-5"><a href="#cb39-5"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Score <span class="kw">DESC</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Exercise:</strong> Pick two tags that interest you and you think will occur together and find the top voted posts that contain both.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb40-1"><a href="#cb40-1"></a><span class="kw">SELECT</span> TOP(<span class="dv">1</span>)</span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="kw">Id</span>, Title, Score, <span class="kw">Body</span>, Tags</span>
<span id="cb40-3"><a href="#cb40-3"></a><span class="kw">FROM</span> Posts</span>
<span id="cb40-4"><a href="#cb40-4"></a><span class="kw">WHERE</span> Tags <span class="kw">LIKE</span> <span class="st">'%germany%'</span> <span class="kw">AND</span> Tags <span class="kw">LIKE</span> <span class="st">'%walking%'</span> </span>
<span id="cb40-5"><a href="#cb40-5"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Score <span class="kw">DESC</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="sql-summarization" class="level3">
<h3 class="anchored" data-anchor-id="sql-summarization">SQL Summarization</h3>
<p>So far, we have covered the equivalent of R‚Äôs selecting, filtering, and arranging.</p>
<p>Let‚Äôs take a look at grouping and summarizing now, which has similar structures in both <code>R</code> and SQL. Imagine we want to see how many posts of each type there are. This query shows us that there are 44K questions and 71K answers.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb41-1"><a href="#cb41-1"></a><span class="kw">SELECT</span> </span>
<span id="cb41-2"><a href="#cb41-2"></a>PostTypeId, <span class="fu">COUNT</span>(<span class="kw">Id</span>) numPosts</span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="kw">FROM</span> posts</span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="kw">GROUP</span> <span class="kw">BY</span> PostTypeId </span>
<span id="cb41-5"><a href="#cb41-5"></a><span class="kw">ORDER</span> <span class="kw">BY</span> PostTypeId</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note two characteristics of SQL summarization here:</p>
<ul>
<li>The <code>GROUP BY</code>clause indicates the table column for grouping, much like R‚Äôs <code>group_by</code>.</li>
<li>There is no explicit <code>summarize</code>. Instead, all columns that appear in the SELECT except for those listed in <code>GROUP BY</code> must make use of an aggregate function. <code>COUNT(*)</code> is one of these, and is the equivalent of R‚Äôs <code>n()</code>. Many other <a href="https://docs.microsoft.com/en-us/sql/t-sql/functions/aggregate-functions-transact-sql">aggregate functions</a> exist, including <code>MAX</code>, <code>SUM</code>, <code>AVG</code>, and many others. Every aggregate function requires a column as an argument (even <code>COUNT()</code> which doesn‚Äôt logically need one).</li>
<li>The aggregate column (in this case <code>COUNT(Id)</code>) must immediately be followed by a name that will be used for it in the results (in this case <code>numPosts</code>). This can be particularly useful if you want to order by the aggregated value.</li>
</ul>
<p><strong>Exercise:</strong> Change the previous query so it orders the result rows by the number of posts of that type. <em>Hint: Reuse the name you assigned to the aggregate function.</em></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb42-1"><a href="#cb42-1"></a><span class="kw">SELECT</span> </span>
<span id="cb42-2"><a href="#cb42-2"></a>PostTypeId, <span class="fu">COUNT</span>(<span class="kw">Id</span>) numPosts</span>
<span id="cb42-3"><a href="#cb42-3"></a><span class="kw">FROM</span> posts</span>
<span id="cb42-4"><a href="#cb42-4"></a><span class="kw">GROUP</span> <span class="kw">BY</span> PostTypeId </span>
<span id="cb42-5"><a href="#cb42-5"></a><span class="kw">ORDER</span> <span class="kw">BY</span> numPosts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Exercise:</strong> Find the most commonly used tagsets (sets/combinations of tags) applied to posts. Note that this is not asking you to count the most common individual tags ‚Äî this would be more complex because multiple tags are squashed into the Tags field.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb43-1"><a href="#cb43-1"></a><span class="kw">SELECT</span> </span>
<span id="cb43-2"><a href="#cb43-2"></a>Tags, <span class="fu">COUNT</span>(Tags) numTags</span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="kw">FROM</span> posts</span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="kw">GROUP</span> <span class="kw">BY</span> Tags </span>
<span id="cb43-5"><a href="#cb43-5"></a><span class="kw">ORDER</span> <span class="kw">BY</span> numTags</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="sql-joins" class="level3">
<h3 class="anchored" data-anchor-id="sql-joins">SQL Joins</h3>
<p>Finally, as with <code>R</code>, we often want to join data from two or more tables. The types of joins in SQL are the same as we saw with R (inner, outer, left, right). Most commonly we want to perform an INNER join, which is the default if you just say <code>JOIN</code>. (We can look up the <code>inner_join()</code> documentation to remind ourselves what an inner join does.)</p>
<p>Let‚Äôs say we wanted to enhance the earlier query to find the highest scoring answers with some information about each user.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb44-1"><a href="#cb44-1"></a><span class="kw">SELECT</span> TOP(<span class="dv">100</span>)</span>
<span id="cb44-2"><a href="#cb44-2"></a>Title, Score, DisplayName, Reputation</span>
<span id="cb44-3"><a href="#cb44-3"></a><span class="kw">FROM</span> Posts p</span>
<span id="cb44-4"><a href="#cb44-4"></a><span class="kw">JOIN</span> Users u</span>
<span id="cb44-5"><a href="#cb44-5"></a><span class="kw">ON</span> p.OwnerUserId <span class="op">=</span> u.<span class="kw">Id</span></span>
<span id="cb44-6"><a href="#cb44-6"></a><span class="kw">WHERE</span> PostTypeId <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb44-7"><a href="#cb44-7"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Score <span class="kw">Desc</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We see a few notable items here:</p>
<ul>
<li>The <code>JOIN</code> keyword must go in between the two tables we want to join.</li>
<li>Each table must be named. In this case we named posts <code>p</code> and users <code>u</code>.</li>
<li>We need to specify the relationship that joins the two tables. In this case, a posts <code>OwnerUserId</code> column refers to the <code>Id</code> column in the users table.</li>
</ul>
<p><strong>Exercise:</strong> Create a query similar to the one above that identifies the authors of the top rated comments instead of posts.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb45-1"><a href="#cb45-1"></a><span class="kw">SELECT</span> TOP(<span class="dv">100</span>)</span>
<span id="cb45-2"><a href="#cb45-2"></a>Text, Score, DisplayName, Reputation, AboutMe, Views, UpVotes, DownVotes</span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="kw">FROM</span> Comments c</span>
<span id="cb45-4"><a href="#cb45-4"></a><span class="kw">JOIN</span> Users u</span>
<span id="cb45-5"><a href="#cb45-5"></a><span class="kw">ON</span> c.UserId <span class="op">=</span> u.<span class="kw">Id</span></span>
<span id="cb45-6"><a href="#cb45-6"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Score <span class="kw">Desc</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>If you want more practice, go to <a href="https://mystery.knightlab.com/" class="uri">https://mystery.knightlab.com/</a>.</p>
</section>
</section>
<section id="going-beyond" class="level2">
<h2 class="anchored" data-anchor-id="going-beyond">Going Beyond</h2>
<section id="exploring-cloud-dbmss" class="level3">
<h3 class="anchored" data-anchor-id="exploring-cloud-dbmss">Exploring cloud DBMS‚Äôs</h3>
<p><a href="https://aws.amazon.com/redshift/">Redshift</a> is Amazon‚Äôs cloud database management system (DBMS).</p>
<ul>
<li>To try out Redshift, you can sign up for a free <a href="https://aws.amazon.com/education/awseducate/">AWS Educate</a> account. Once your account is confirmed, you will have access to many tutorials about cloud computing.</li>
<li>In the Getting Started section of your <a href="https://www.awseducate.com/student/s/">AWS Educate main page</a>, navigate to the <a href="https://awseducate.instructure.com/courses/912">Getting Started with Databases (Lab)</a> tutorial on the second page of tutorials.</li>
<li>Various Redshift resources can be found <a href="https://aws.amazon.com/redshift/getting-started/">here</a>.</li>
</ul>
<p><a href="https://cloud.google.com/bigquery/">BigQuery</a> is Google‚Äôs DBMS.</p>
<ul>
<li>BigQuery can be tried for free through <a href="https://cloud.google.com/blog/products/data-analytics/query-without-a-credit-card-introducing-bigquery-sandbox">Big Query sandbox</a>.</li>
<li>On the <a href="https://cloud.google.com/bigquery/">main BigQuery page</a> you‚Äôll see a big blue button that says ‚ÄúTry BigQuery free‚Äù.</li>
<li>On the cloud welcome page under the Products section, you‚Äôll see a button for ‚ÄúAnalyze and manage data - BigQuery‚Äù.</li>
<li>Accessing public data within BigQuery
<ul>
<li>In your ‚ÄúWelcome to BigQuery Studio!‚Äù window, you‚Äôll see a ‚ÄúTry the Google Trends Demo Query‚Äù section.</li>
<li>Click the ‚ÄúOpen this query‚Äù blue button to get an example SQL statement for the Google Trends dataset. You‚Äôll also see on the left panel a list of all public datasets available through BigQuery. ## Done!</li>
</ul></li>
<li>Check the ICA Instructions for how to (a) push your code to GitHub and (b) update your portfolio website</li>
</ul>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../../src/ica/15-scraping-notes.html" class="pagination-link" aria-label="15 Web scraping">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">15 Web scraping</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../src/ica/18-interactive-viz-notes.html" class="pagination-link" aria-label="18 Interactive Viz">
        <span class="nav-page-text"><span class="chapter-title">18 Interactive Viz</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb46" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb46-1"><a href="#cb46-1"></a><span class="co">---</span></span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="an">title:</span><span class="co"> "16 Databases and SQL"</span></span>
<span id="cb46-3"><a href="#cb46-3"></a><span class="co">---</span></span>
<span id="cb46-4"><a href="#cb46-4"></a></span>
<span id="cb46-5"><a href="#cb46-5"></a><span class="fu">## üß© Learning Goals</span></span>
<span id="cb46-6"><a href="#cb46-6"></a></span>
<span id="cb46-7"><a href="#cb46-7"></a>By the end of this lesson, you should be able to:</span>
<span id="cb46-8"><a href="#cb46-8"></a><span class="ss">- </span>Develop comfort in composing SQL queries</span>
<span id="cb46-9"><a href="#cb46-9"></a><span class="ss">- </span>See the connections between <span class="in">`tidyverse`</span> verbs and SQL clauses</span>
<span id="cb46-10"><a href="#cb46-10"></a></span>
<span id="cb46-11"><a href="#cb46-11"></a></span>
<span id="cb46-12"><a href="#cb46-12"></a><span class="in">```{r setup_16, echo=FALSE, message=FALSE}</span></span>
<span id="cb46-13"><a href="#cb46-13"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb46-14"><a href="#cb46-14"></a><span class="fu">library</span>(DBI)</span>
<span id="cb46-15"><a href="#cb46-15"></a><span class="fu">library</span>(duckdb)</span>
<span id="cb46-16"><a href="#cb46-16"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb46-17"><a href="#cb46-17"></a><span class="in">```</span></span>
<span id="cb46-18"><a href="#cb46-18"></a></span>
<span id="cb46-19"><a href="#cb46-19"></a></span>
<span id="cb46-20"><a href="#cb46-20"></a><span class="fu">## Introduction</span></span>
<span id="cb46-21"><a href="#cb46-21"></a></span>
<span id="cb46-22"><a href="#cb46-22"></a>If you find yourself analyzing data within a medium or large organization, you will probably draw on data stored within a centralized <span class="co">[</span><span class="ot">data warehouse</span><span class="co">](https://en.wikipedia.org/wiki/Data_warehouse)</span>.</span>
<span id="cb46-23"><a href="#cb46-23"></a></span>
<span id="cb46-24"><a href="#cb46-24"></a></span>
<span id="cb46-25"><a href="#cb46-25"></a>Data warehouses contain vast collections of information--far more than a desktop or laptop computer can easily analyze. </span>
<span id="cb46-26"><a href="#cb46-26"></a></span>
<span id="cb46-27"><a href="#cb46-27"></a>These warehouses typically rely on structured data repositories called **relational databases** (also often called **SQL databases**).</span>
<span id="cb46-28"><a href="#cb46-28"></a></span>
<span id="cb46-29"><a href="#cb46-29"></a></span>
<span id="cb46-30"><a href="#cb46-30"></a>Relational databases store data in **tables**, which are structured with rows and columns (attributes). Tables can be joined using **keys** which uniquely identify a row within a table.</span>
<span id="cb46-31"><a href="#cb46-31"></a></span>
<span id="cb46-32"><a href="#cb46-32"></a></span>
<span id="cb46-33"><a href="#cb46-33"></a><span class="fu">## Connecting to a database in R with `DBI`</span></span>
<span id="cb46-34"><a href="#cb46-34"></a></span>
<span id="cb46-35"><a href="#cb46-35"></a>The <span class="in">`DBI`</span> package (**d**ata**b**ase **i**nterface) provides general tools for interacting with databases from R. </span>
<span id="cb46-36"><a href="#cb46-36"></a></span>
<span id="cb46-37"><a href="#cb46-37"></a><span class="ss">- </span>It is also common for data scientists to interact with databases directly by writing SQL queries. We'll talk about this in the next section.</span>
<span id="cb46-38"><a href="#cb46-38"></a></span>
<span id="cb46-39"><a href="#cb46-39"></a></span>
<span id="cb46-40"><a href="#cb46-40"></a>For now, we'll use <span class="in">`DBI`</span> to connect with an **in-process** database (<span class="in">`duckdb`</span>), one that runs locally on your computer. </span>
<span id="cb46-41"><a href="#cb46-41"></a></span>
<span id="cb46-42"><a href="#cb46-42"></a><span class="ss">- </span>A nice feature of <span class="in">`duckdb`</span> is that even if your dataset is huge, <span class="in">`duckdb`</span> can work with it very quickly.</span>
<span id="cb46-43"><a href="#cb46-43"></a></span>
<span id="cb46-44"><a href="#cb46-44"></a></span>
<span id="cb46-45"><a href="#cb46-45"></a>We can set up a database connection with <span class="in">`dbConnect()`</span> and initialize a temporary database with <span class="in">`duckdb()`</span>:</span>
<span id="cb46-46"><a href="#cb46-46"></a></span>
<span id="cb46-49"><a href="#cb46-49"></a><span class="in">```{r}</span></span>
<span id="cb46-50"><a href="#cb46-50"></a>con <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>())</span>
<span id="cb46-51"><a href="#cb46-51"></a><span class="fu">class</span>(con)</span>
<span id="cb46-52"><a href="#cb46-52"></a><span class="in">```</span></span>
<span id="cb46-53"><a href="#cb46-53"></a></span>
<span id="cb46-54"><a href="#cb46-54"></a></span>
<span id="cb46-55"><a href="#cb46-55"></a>In a real project, we would use <span class="in">`duckdb_read_csv()`</span> to store data directly into the <span class="in">`duckdb`</span> database without first having to read it into R. </span>
<span id="cb46-56"><a href="#cb46-56"></a></span>
<span id="cb46-57"><a href="#cb46-57"></a>In the toy example below, we have a dataset on Spotify songs (<span class="in">`all_spotify_songs.csv`</span>) and store in a database table called <span class="in">`"songs"`</span>:</span>
<span id="cb46-58"><a href="#cb46-58"></a></span>
<span id="cb46-59"><a href="#cb46-59"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb46-60"><a href="#cb46-60"></a><span class="fu">duckdb_read_csv</span>(con, <span class="st">"songs"</span>, <span class="st">"https://hash-mac.github.io/stat212site-f25/relative/path/to/all_spotify_songs.csv"</span>)</span>
<span id="cb46-61"><a href="#cb46-61"></a><span class="in">```</span></span>
<span id="cb46-62"><a href="#cb46-62"></a></span>
<span id="cb46-63"><a href="#cb46-63"></a></span>
<span id="cb46-64"><a href="#cb46-64"></a>Here, we'll use datasets from the <span class="in">`nycflights13`</span> package. </span>
<span id="cb46-65"><a href="#cb46-65"></a></span>
<span id="cb46-66"><a href="#cb46-66"></a>The <span class="in">`DBI`</span> package provides the <span class="in">`dbWriteTable()`</span> function to write dataset objects (in constrast to csv files) to a database:</span>
<span id="cb46-67"><a href="#cb46-67"></a></span>
<span id="cb46-70"><a href="#cb46-70"></a><span class="in">```{r}</span></span>
<span id="cb46-71"><a href="#cb46-71"></a><span class="fu">dbWriteTable</span>(con, <span class="st">"flights"</span>, nycflights13<span class="sc">::</span>flights)</span>
<span id="cb46-72"><a href="#cb46-72"></a><span class="fu">dbWriteTable</span>(con, <span class="st">"planes"</span>, nycflights13<span class="sc">::</span>planes)</span>
<span id="cb46-73"><a href="#cb46-73"></a><span class="in">```</span></span>
<span id="cb46-74"><a href="#cb46-74"></a></span>
<span id="cb46-75"><a href="#cb46-75"></a>We can use <span class="in">`tbl()`</span>, short for table, to create connections individually to the <span class="in">`flights`</span> and <span class="in">`planes`</span> datasets.</span>
<span id="cb46-76"><a href="#cb46-76"></a></span>
<span id="cb46-79"><a href="#cb46-79"></a><span class="in">```{r}</span></span>
<span id="cb46-80"><a href="#cb46-80"></a>flights <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"flights"</span>)</span>
<span id="cb46-81"><a href="#cb46-81"></a>planes <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"planes"</span>)</span>
<span id="cb46-82"><a href="#cb46-82"></a><span class="in">```</span></span>
<span id="cb46-83"><a href="#cb46-83"></a></span>
<span id="cb46-84"><a href="#cb46-84"></a></span>
<span id="cb46-85"><a href="#cb46-85"></a>Note that the results of <span class="in">`tbl()`</span> are not quite the same as our normal data frames. </span>
<span id="cb46-86"><a href="#cb46-86"></a></span>
<span id="cb46-87"><a href="#cb46-87"></a>Although they have class <span class="in">`tbl`</span>, note that the number of rows is <span class="in">`NA`</span>! </span>
<span id="cb46-88"><a href="#cb46-88"></a></span>
<span id="cb46-89"><a href="#cb46-89"></a></span>
<span id="cb46-90"><a href="#cb46-90"></a>The full dataset isn't loaded into memory when we use <span class="in">`tbl`</span>, so the number of rows is unknown. This behavior is purposeful--it reduces computer resources and allows access to parts of the data only when needed.</span>
<span id="cb46-91"><a href="#cb46-91"></a></span>
<span id="cb46-94"><a href="#cb46-94"></a><span class="in">```{r}</span></span>
<span id="cb46-95"><a href="#cb46-95"></a><span class="fu">class</span>(flights)</span>
<span id="cb46-96"><a href="#cb46-96"></a><span class="fu">dim</span>(flights)</span>
<span id="cb46-97"><a href="#cb46-97"></a><span class="in">```</span></span>
<span id="cb46-98"><a href="#cb46-98"></a></span>
<span id="cb46-99"><a href="#cb46-99"></a></span>
<span id="cb46-100"><a href="#cb46-100"></a><span class="fu">## What is SQL? </span></span>
<span id="cb46-101"><a href="#cb46-101"></a></span>
<span id="cb46-102"><a href="#cb46-102"></a>SQL stands for Structured Query Language. </span>
<span id="cb46-103"><a href="#cb46-103"></a></span>
<span id="cb46-104"><a href="#cb46-104"></a>It is a programming language to query or retrieve data from a relational database. </span>
<span id="cb46-105"><a href="#cb46-105"></a></span>
<span id="cb46-106"><a href="#cb46-106"></a></span>
<span id="cb46-107"><a href="#cb46-107"></a><span class="fu">## SQL with `dplyr`</span></span>
<span id="cb46-108"><a href="#cb46-108"></a></span>
<span id="cb46-109"><a href="#cb46-109"></a>A really nice feature of <span class="in">`dplyr`</span> is that we can write R code for wrangling the data and use <span class="in">`show_query()`</span> to translate that code into SQL.</span>
<span id="cb46-110"><a href="#cb46-110"></a></span>
<span id="cb46-113"><a href="#cb46-113"></a><span class="in">```{r}</span></span>
<span id="cb46-114"><a href="#cb46-114"></a>flights <span class="sc">|&gt;</span></span>
<span id="cb46-115"><a href="#cb46-115"></a>    <span class="fu">show_query</span>()</span>
<span id="cb46-116"><a href="#cb46-116"></a></span>
<span id="cb46-117"><a href="#cb46-117"></a>flights <span class="sc">|&gt;</span></span>
<span id="cb46-118"><a href="#cb46-118"></a>    <span class="fu">mutate</span>(<span class="at">full_date =</span> <span class="fu">str_c</span>(year, month, day, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb46-119"><a href="#cb46-119"></a>    <span class="fu">show_query</span>()</span>
<span id="cb46-120"><a href="#cb46-120"></a><span class="in">```</span></span>
<span id="cb46-121"><a href="#cb46-121"></a></span>
<span id="cb46-122"><a href="#cb46-122"></a></span>
<span id="cb46-123"><a href="#cb46-123"></a>**Explore:** Create a Google Document and share it with the people at your table. Using the code examples below, work with your group to co-create a <span class="in">`dplyr`</span>&lt;-&gt; SQL translation guide (notes document) that allows you to answer the following:</span>
<span id="cb46-124"><a href="#cb46-124"></a></span>
<span id="cb46-125"><a href="#cb46-125"></a><span class="ss">- </span>What do <span class="in">`SELECT`</span>, <span class="in">`FROM`</span>, <span class="in">`WHERE`</span>, <span class="in">`GROUP BY`</span>, and <span class="in">`ORDER BY`</span> in SQL do? (These uppercase words are called **clauses** in SQL.) </span>
<span id="cb46-126"><a href="#cb46-126"></a><span class="ss">  - </span>How do these clauses translate to the main <span class="in">`tidyverse`</span> verbs <span class="in">`select`</span>, <span class="in">`mutate`</span>, <span class="in">`filter`</span>, <span class="in">`arrange`</span>, <span class="in">`summarize`</span>, <span class="in">`group_by`</span>?</span>
<span id="cb46-127"><a href="#cb46-127"></a><span class="ss">- </span>What syntax differences are there for logical comparisons? </span>
<span id="cb46-128"><a href="#cb46-128"></a><span class="ss">  - </span>How do the <span class="in">`&amp;`</span> and <span class="in">`|`</span> logical operators in R compare to SQL?</span>
<span id="cb46-129"><a href="#cb46-129"></a><span class="ss">- </span>How does the R syntax for <span class="in">`mutate`</span> translate to SQL?</span>
<span id="cb46-130"><a href="#cb46-130"></a><span class="ss">- </span>How does joining datasets seem to work in SQL?</span>
<span id="cb46-131"><a href="#cb46-131"></a></span>
<span id="cb46-132"><a href="#cb46-132"></a></span>
<span id="cb46-133"><a href="#cb46-133"></a></span>
<span id="cb46-136"><a href="#cb46-136"></a><span class="in">```{r}</span></span>
<span id="cb46-137"><a href="#cb46-137"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb46-138"><a href="#cb46-138"></a>    <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"IAH"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb46-139"><a href="#cb46-139"></a>    <span class="fu">arrange</span>(dep_delay) <span class="sc">|&gt;</span> </span>
<span id="cb46-140"><a href="#cb46-140"></a>    <span class="fu">show_query</span>()</span>
<span id="cb46-141"><a href="#cb46-141"></a></span>
<span id="cb46-142"><a href="#cb46-142"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb46-143"><a href="#cb46-143"></a>    <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"IAH"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb46-144"><a href="#cb46-144"></a>    <span class="fu">arrange</span>(dep_delay) <span class="sc">|&gt;</span> </span>
<span id="cb46-145"><a href="#cb46-145"></a>    <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb46-146"><a href="#cb46-146"></a>    <span class="fu">show_query</span>()</span>
<span id="cb46-147"><a href="#cb46-147"></a></span>
<span id="cb46-148"><a href="#cb46-148"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb46-149"><a href="#cb46-149"></a>    <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"IAH"</span> <span class="sc">&amp;</span> origin <span class="sc">==</span> <span class="st">"JFK"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb46-150"><a href="#cb46-150"></a>    <span class="fu">arrange</span>(dep_delay) <span class="sc">|&gt;</span> </span>
<span id="cb46-151"><a href="#cb46-151"></a>    <span class="fu">show_query</span>()</span>
<span id="cb46-152"><a href="#cb46-152"></a></span>
<span id="cb46-153"><a href="#cb46-153"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb46-154"><a href="#cb46-154"></a>    <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">"IAH"</span> <span class="sc">|</span> origin <span class="sc">==</span> <span class="st">"JFK"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb46-155"><a href="#cb46-155"></a>    <span class="fu">arrange</span>(year, month, day, <span class="fu">desc</span>(dep_delay)) <span class="sc">|&gt;</span> </span>
<span id="cb46-156"><a href="#cb46-156"></a>    <span class="fu">show_query</span>()</span>
<span id="cb46-157"><a href="#cb46-157"></a><span class="in">```</span></span>
<span id="cb46-158"><a href="#cb46-158"></a></span>
<span id="cb46-161"><a href="#cb46-161"></a><span class="in">```{r}</span></span>
<span id="cb46-162"><a href="#cb46-162"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb46-163"><a href="#cb46-163"></a>    <span class="fu">filter</span>(dest <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"IAH"</span>, <span class="st">"HOU"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb46-164"><a href="#cb46-164"></a>    <span class="fu">show_query</span>()</span>
<span id="cb46-165"><a href="#cb46-165"></a></span>
<span id="cb46-166"><a href="#cb46-166"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb46-167"><a href="#cb46-167"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(dep_delay)) <span class="sc">|&gt;</span> </span>
<span id="cb46-168"><a href="#cb46-168"></a>    <span class="fu">show_query</span>()</span>
<span id="cb46-169"><a href="#cb46-169"></a><span class="in">```</span></span>
<span id="cb46-170"><a href="#cb46-170"></a></span>
<span id="cb46-173"><a href="#cb46-173"></a><span class="in">```{r}</span></span>
<span id="cb46-174"><a href="#cb46-174"></a>planes <span class="sc">|&gt;</span> </span>
<span id="cb46-175"><a href="#cb46-175"></a>    <span class="fu">select</span>(tailnum, type, manufacturer, model, year) <span class="sc">|&gt;</span> </span>
<span id="cb46-176"><a href="#cb46-176"></a>    <span class="fu">show_query</span>()</span>
<span id="cb46-177"><a href="#cb46-177"></a></span>
<span id="cb46-178"><a href="#cb46-178"></a>planes <span class="sc">|&gt;</span> </span>
<span id="cb46-179"><a href="#cb46-179"></a>    <span class="fu">select</span>(tailnum, type, manufacturer, model, year) <span class="sc">|&gt;</span> </span>
<span id="cb46-180"><a href="#cb46-180"></a>    <span class="fu">rename</span>(<span class="at">year_built =</span> year) <span class="sc">|&gt;</span> </span>
<span id="cb46-181"><a href="#cb46-181"></a>    <span class="fu">show_query</span>()</span>
<span id="cb46-182"><a href="#cb46-182"></a><span class="in">```</span></span>
<span id="cb46-183"><a href="#cb46-183"></a></span>
<span id="cb46-186"><a href="#cb46-186"></a><span class="in">```{r}</span></span>
<span id="cb46-187"><a href="#cb46-187"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb46-188"><a href="#cb46-188"></a>    <span class="fu">mutate</span>(</span>
<span id="cb46-189"><a href="#cb46-189"></a>        <span class="at">speed =</span> distance <span class="sc">/</span> (air_time <span class="sc">/</span> <span class="dv">60</span>)</span>
<span id="cb46-190"><a href="#cb46-190"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb46-191"><a href="#cb46-191"></a>    <span class="fu">show_query</span>()</span>
<span id="cb46-192"><a href="#cb46-192"></a><span class="in">```</span></span>
<span id="cb46-193"><a href="#cb46-193"></a></span>
<span id="cb46-196"><a href="#cb46-196"></a><span class="in">```{r}</span></span>
<span id="cb46-197"><a href="#cb46-197"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb46-198"><a href="#cb46-198"></a>    <span class="fu">left_join</span>(planes, <span class="at">by =</span> <span class="st">"tailnum"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb46-199"><a href="#cb46-199"></a>    <span class="fu">show_query</span>()</span>
<span id="cb46-200"><a href="#cb46-200"></a><span class="in">```</span></span>
<span id="cb46-201"><a href="#cb46-201"></a></span>
<span id="cb46-202"><a href="#cb46-202"></a></span>
<span id="cb46-203"><a href="#cb46-203"></a></span>
<span id="cb46-204"><a href="#cb46-204"></a><span class="fu">## SQL Practice</span></span>
<span id="cb46-205"><a href="#cb46-205"></a></span>
<span id="cb46-206"><a href="#cb46-206"></a><span class="fu">### Stack Exchange Data Explorer </span></span>
<span id="cb46-207"><a href="#cb46-207"></a></span>
<span id="cb46-208"><a href="#cb46-208"></a>We will experiment with the <span class="co">[</span><span class="ot">Stack Exchange Data Explorer</span><span class="co">](https://data.stackexchange.com/)</span>, a website that provides a SQL interface for all the data in StackExchange. </span>
<span id="cb46-209"><a href="#cb46-209"></a></span>
<span id="cb46-210"><a href="#cb46-210"></a>StackExchange powers the StackOverflow programming question and answer site, but it also powers question and answer sites related to <span class="co">[</span><span class="ot">126 topics</span><span class="co">](https://stackexchange.com/sites?view=grid)</span> including <span class="co">[</span><span class="ot">English</span><span class="co">](https://english.stackexchange.com/)</span>, <span class="co">[</span><span class="ot">Travel</span><span class="co">](https://travel.stackexchange.com/)</span>, <span class="co">[</span><span class="ot">Bicycles</span><span class="co">](https://bicycles.stackexchange.com/)</span>, and <span class="co">[</span><span class="ot">Parenting</span><span class="co">](https://parenting.stackexchange.com/)</span>. </span>
<span id="cb46-211"><a href="#cb46-211"></a></span>
<span id="cb46-212"><a href="#cb46-212"></a>StackExchange provides an in-depth <span class="co">[</span><span class="ot">Data Explorer Tutorial</span><span class="co">](https://data.stackexchange.com/help)</span>. We start with this interface to construct SQL queries on the <span class="co">[</span><span class="ot">Travel Data Explorer</span><span class="co">](https://data.stackexchange.com/travel/queries)</span>.</span>
<span id="cb46-213"><a href="#cb46-213"></a></span>
<span id="cb46-214"><a href="#cb46-214"></a></span>
<span id="cb46-215"><a href="#cb46-215"></a><span class="fu">### Instructions </span></span>
<span id="cb46-216"><a href="#cb46-216"></a></span>
<span id="cb46-217"><a href="#cb46-217"></a>Head to the <span class="co">[</span><span class="ot">Stack Exchange Data Explorer for Travel</span><span class="co">](https://data.stackexchange.com/travel/queries)</span>. </span>
<span id="cb46-218"><a href="#cb46-218"></a></span>
<span id="cb46-219"><a href="#cb46-219"></a></span>
<span id="cb46-220"><a href="#cb46-220"></a>You will see a list of queries other users have created in the past. These queries are for all Stack Exchange sites, so some may not be relevant. Queries about *your* activity (for example, "How many upvotes do I have for each tag?") will not be useful either if you do not have activity for the particular site. </span>
<span id="cb46-221"><a href="#cb46-221"></a></span>
<span id="cb46-222"><a href="#cb46-222"></a></span>
<span id="cb46-223"><a href="#cb46-223"></a>Click on one of them and you see the SQL code for the query. </span>
<span id="cb46-224"><a href="#cb46-224"></a></span>
<span id="cb46-225"><a href="#cb46-225"></a>Then click the "Run Query" button to get results. </span>
<span id="cb46-226"><a href="#cb46-226"></a></span>
<span id="cb46-227"><a href="#cb46-227"></a>For example, you might look at the number of <span class="co">[</span><span class="ot">up vs down votes for questions and answers by weekday</span><span class="co">](https://data.stackexchange.com/travel/query/1718/up-vs-down-votes-by-day-of-week-of-question-or-answer)</span> and notice that for questions, Tuesday has the highest up vs. down vote ratio and Saturday has the lowest. You can contemplate hypotheses for this difference!</span>
<span id="cb46-228"><a href="#cb46-228"></a></span>
<span id="cb46-229"><a href="#cb46-229"></a></span>
<span id="cb46-230"><a href="#cb46-230"></a><span class="fu">### Select Queries </span></span>
<span id="cb46-231"><a href="#cb46-231"></a></span>
<span id="cb46-232"><a href="#cb46-232"></a>Let's experiment with our own queries. </span>
<span id="cb46-233"><a href="#cb46-233"></a></span>
<span id="cb46-234"><a href="#cb46-234"></a>Click on "Compose Query" in the upper right, and notice the tables are shown in the right. </span>
<span id="cb46-235"><a href="#cb46-235"></a></span>
<span id="cb46-236"><a href="#cb46-236"></a>As a reminder, a table is similar to a data frame. </span>
<span id="cb46-237"><a href="#cb46-237"></a></span>
<span id="cb46-238"><a href="#cb46-238"></a><span class="ss">- </span>Each table lists the columns stored within the table and the data types for the columns. </span>
<span id="cb46-239"><a href="#cb46-239"></a><span class="ss">- </span>Look through the tables for Posts, Users, and Comments. </span>
<span id="cb46-240"><a href="#cb46-240"></a><span class="ss">- </span>Do the columns generally make sense, and correspond to the StackOverflow website? </span>
<span id="cb46-241"><a href="#cb46-241"></a></span>
<span id="cb46-242"><a href="#cb46-242"></a></span>
<span id="cb46-243"><a href="#cb46-243"></a>There's a  <span class="co">[</span><span class="ot">description of the tables and columns</span><span class="co">](https://meta.stackexchange.com/a/2678)</span> (called a schema) available on StackExchange's Meta Q&amp;A Site. </span>
<span id="cb46-244"><a href="#cb46-244"></a></span>
<span id="cb46-245"><a href="#cb46-245"></a>Now enter your first query in the text box and click the "Run Query" button:</span>
<span id="cb46-246"><a href="#cb46-246"></a></span>
<span id="cb46-247"><a href="#cb46-247"></a><span class="in">```{sql eval=FALSE}</span></span>
<span id="cb46-248"><a href="#cb46-248"></a><span class="kw">SELECT</span> TOP(<span class="dv">100</span>) Id, Title, Score, Body, Tags</span>
<span id="cb46-249"><a href="#cb46-249"></a><span class="kw">FROM</span> Posts</span>
<span id="cb46-250"><a href="#cb46-250"></a><span class="in">```</span></span>
<span id="cb46-251"><a href="#cb46-251"></a></span>
<span id="cb46-252"><a href="#cb46-252"></a>In this query we already see several important features of SQL:</span>
<span id="cb46-253"><a href="#cb46-253"></a></span>
<span id="cb46-254"><a href="#cb46-254"></a><span class="ss">- </span><span class="in">`SELECT`</span> tells SQL that a query is coming.</span>
<span id="cb46-255"><a href="#cb46-255"></a><span class="ss">- </span><span class="in">`TOP(100)`</span> only returns the first 100 rows.</span>
<span id="cb46-256"><a href="#cb46-256"></a><span class="ss">    - </span>Note: The StackExchange data explorer uses a variant of SQL called <span class="co">[</span><span class="ot">Transact SQL</span><span class="co">](https://en.wikipedia.org/wiki/Transact-SQL)</span> that is supported by Microsoft databases. <span class="in">`TOP(100)`</span> is a non-standard SQL feature supported by T-SQL. For most databases you would accomplish the same goal by adding <span class="in">`LIMIT 100`</span> to the end of the query.</span>
<span id="cb46-257"><a href="#cb46-257"></a><span class="ss">- </span><span class="in">`Id, Title, Score, Body, Tags`</span> determines what columns are included in the result</span>
<span id="cb46-258"><a href="#cb46-258"></a><span class="ss">- </span><span class="in">`FROM Posts`</span> determines the source dataset.</span>
<span id="cb46-259"><a href="#cb46-259"></a></span>
<span id="cb46-260"><a href="#cb46-260"></a></span>
<span id="cb46-261"><a href="#cb46-261"></a>From glancing at the results, it appears that this table contains both questions and answers. </span>
<span id="cb46-262"><a href="#cb46-262"></a></span>
<span id="cb46-263"><a href="#cb46-263"></a>Let's try to focus on answers. </span>
<span id="cb46-264"><a href="#cb46-264"></a></span>
<span id="cb46-265"><a href="#cb46-265"></a>Looking again at the <span class="co">[</span><span class="ot">Schema Description</span><span class="co">](https://meta.stackexchange.com/a/2678)</span>, notice that there is a <span class="in">`PostTypeId`</span> column in <span class="in">`Posts`</span>, and a value of <span class="in">`1`</span> corresponds to questions. </span>
<span id="cb46-266"><a href="#cb46-266"></a></span>
<span id="cb46-267"><a href="#cb46-267"></a>Let's update our query to only include questions:</span>
<span id="cb46-268"><a href="#cb46-268"></a></span>
<span id="cb46-269"><a href="#cb46-269"></a><span class="in">```{sql eval=FALSE}</span></span>
<span id="cb46-270"><a href="#cb46-270"></a><span class="kw">SELECT</span> TOP(<span class="dv">100</span>)</span>
<span id="cb46-271"><a href="#cb46-271"></a>Id, Title, Score, Body, Tags</span>
<span id="cb46-272"><a href="#cb46-272"></a><span class="kw">FROM</span> Posts</span>
<span id="cb46-273"><a href="#cb46-273"></a><span class="kw">WHERE</span> PostTypeId <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb46-274"><a href="#cb46-274"></a><span class="in">```</span></span>
<span id="cb46-275"><a href="#cb46-275"></a></span>
<span id="cb46-276"><a href="#cb46-276"></a>The SQL command <span class="in">`WHERE`</span> is like the <span class="in">`filter`</span> command we have been using in <span class="in">`dplyr`</span>.</span>
<span id="cb46-277"><a href="#cb46-277"></a></span>
<span id="cb46-278"><a href="#cb46-278"></a><span class="ss">- </span>Note that whereas we used the double equals <span class="in">`==`</span> for comparison in <span class="in">`R`</span>, the SQL <span class="in">`WHERE`</span> command takes just a single <span class="in">`=`</span>.</span>
<span id="cb46-279"><a href="#cb46-279"></a></span>
<span id="cb46-280"><a href="#cb46-280"></a>**Exercise:** Find the title and score of Posts that have a score of at least 110. *Hint: TOP is not necessary here because you want all result rows.*</span>
<span id="cb46-281"><a href="#cb46-281"></a></span>
<span id="cb46-282"><a href="#cb46-282"></a><span class="in">```{sql eval=FALSE}</span></span>
<span id="cb46-283"><a href="#cb46-283"></a><span class="kw">SELECT</span> </span>
<span id="cb46-284"><a href="#cb46-284"></a>Title, Score </span>
<span id="cb46-285"><a href="#cb46-285"></a><span class="kw">FROM</span> Posts </span>
<span id="cb46-286"><a href="#cb46-286"></a><span class="kw">WHERE</span> SCORE <span class="op">&gt;=</span> <span class="dv">110</span></span>
<span id="cb46-287"><a href="#cb46-287"></a><span class="in">```</span></span>
<span id="cb46-288"><a href="#cb46-288"></a></span>
<span id="cb46-289"><a href="#cb46-289"></a>**Exercise:** Find posts whose title contains some place you are interested in (you pick!). *Hint: use SQL's [LIKE operator](http://www.sqltutorial.org/sql-like/).*</span>
<span id="cb46-290"><a href="#cb46-290"></a></span>
<span id="cb46-291"><a href="#cb46-291"></a></span>
<span id="cb46-292"><a href="#cb46-292"></a><span class="in">```{sql eval=FALSE}</span></span>
<span id="cb46-293"><a href="#cb46-293"></a><span class="kw">SELECT</span></span>
<span id="cb46-294"><a href="#cb46-294"></a>Title</span>
<span id="cb46-295"><a href="#cb46-295"></a><span class="kw">FROM</span> Posts</span>
<span id="cb46-296"><a href="#cb46-296"></a><span class="kw">WHERE</span> Title <span class="kw">LIKE</span> <span class="st">'%Berlin%'</span></span>
<span id="cb46-297"><a href="#cb46-297"></a><span class="in">```</span></span>
<span id="cb46-298"><a href="#cb46-298"></a></span>
<span id="cb46-299"><a href="#cb46-299"></a></span>
<span id="cb46-300"><a href="#cb46-300"></a>Note that you can look up the actual webpage for any question using its <span class="in">`Id`</span>. </span>
<span id="cb46-301"><a href="#cb46-301"></a></span>
<span id="cb46-302"><a href="#cb46-302"></a>For example, if the <span class="in">`Id`</span> is 19591, the webpage <span class="co">[</span><span class="ot">URL</span><span class="co">](https://en.wikipedia.org/wiki/URL)</span> would be <span class="ot">&lt;https://travel.stackexchange.com/questions/19591/&gt;</span>. Look up a few of the questions by their <span class="in">`Id`</span>. </span>
<span id="cb46-303"><a href="#cb46-303"></a></span>
<span id="cb46-304"><a href="#cb46-304"></a>It's unclear how the 100 questions we saw were selected from among the over 43,000 total questions.</span>
<span id="cb46-305"><a href="#cb46-305"></a></span>
<span id="cb46-306"><a href="#cb46-306"></a><span class="ss">- </span>To count the number of posts, we can use <span class="in">`COUNT`</span> in SQL: <span class="in">`SELECT COUNT(Id) FROM Posts Where PostTypeId = 1`</span>.</span>
<span id="cb46-307"><a href="#cb46-307"></a></span>
<span id="cb46-308"><a href="#cb46-308"></a></span>
<span id="cb46-309"><a href="#cb46-309"></a>Let's try to arrange the Posts by score. </span>
<span id="cb46-310"><a href="#cb46-310"></a></span>
<span id="cb46-311"><a href="#cb46-311"></a></span>
<span id="cb46-312"><a href="#cb46-312"></a><span class="in">```{sql eval=FALSE}</span></span>
<span id="cb46-313"><a href="#cb46-313"></a><span class="kw">SELECT</span> TOP(<span class="dv">100</span>)</span>
<span id="cb46-314"><a href="#cb46-314"></a>Id, Title, Score, Body, Tags</span>
<span id="cb46-315"><a href="#cb46-315"></a><span class="kw">FROM</span> Posts</span>
<span id="cb46-316"><a href="#cb46-316"></a><span class="kw">WHERE</span> PostTypeId <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb46-317"><a href="#cb46-317"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Score <span class="kw">DESC</span></span>
<span id="cb46-318"><a href="#cb46-318"></a><span class="in">```</span></span>
<span id="cb46-319"><a href="#cb46-319"></a></span>
<span id="cb46-320"><a href="#cb46-320"></a>The <span class="in">`ORDER BY ??? DESC`</span> syntax is similar to R's <span class="in">`arrange()`</span>. You can leave off the <span class="in">`DESC`</span> if you want the results ordered smallest to largest.</span>
<span id="cb46-321"><a href="#cb46-321"></a></span>
<span id="cb46-322"><a href="#cb46-322"></a></span>
<span id="cb46-323"><a href="#cb46-323"></a>We could also find the <span class="co">[</span><span class="ot">highest rated questions tagged "italy"</span><span class="co">](https://travel.stackexchange.com/questions/tagged/italy)</span>:</span>
<span id="cb46-324"><a href="#cb46-324"></a></span>
<span id="cb46-325"><a href="#cb46-325"></a><span class="in">```{sql eval=FALSE}</span></span>
<span id="cb46-326"><a href="#cb46-326"></a><span class="kw">SELECT</span> TOP(<span class="dv">100</span>)</span>
<span id="cb46-327"><a href="#cb46-327"></a>Id, Title, Score, Body, Tags</span>
<span id="cb46-328"><a href="#cb46-328"></a><span class="kw">FROM</span> Posts</span>
<span id="cb46-329"><a href="#cb46-329"></a><span class="kw">WHERE</span> PostTypeId <span class="op">=</span> <span class="dv">1</span> <span class="kw">AND</span> Tags <span class="kw">LIKE</span> <span class="st">'%italy%'</span></span>
<span id="cb46-330"><a href="#cb46-330"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Score <span class="kw">DESC</span></span>
<span id="cb46-331"><a href="#cb46-331"></a><span class="in">```</span></span>
<span id="cb46-332"><a href="#cb46-332"></a></span>
<span id="cb46-333"><a href="#cb46-333"></a></span>
<span id="cb46-334"><a href="#cb46-334"></a>**Exercise:** Pick two tags that interest you and you think will occur together and find the top voted posts that contain both.</span>
<span id="cb46-335"><a href="#cb46-335"></a></span>
<span id="cb46-336"><a href="#cb46-336"></a></span>
<span id="cb46-337"><a href="#cb46-337"></a><span class="in">```{sql eval=FALSE}</span></span>
<span id="cb46-338"><a href="#cb46-338"></a><span class="kw">SELECT</span> TOP(<span class="dv">1</span>)</span>
<span id="cb46-339"><a href="#cb46-339"></a>Id, Title, Score, Body, Tags</span>
<span id="cb46-340"><a href="#cb46-340"></a><span class="kw">FROM</span> Posts</span>
<span id="cb46-341"><a href="#cb46-341"></a><span class="kw">WHERE</span> Tags <span class="kw">LIKE</span> <span class="st">'%germany%'</span> <span class="kw">AND</span> Tags <span class="kw">LIKE</span> <span class="st">'%walking%'</span> </span>
<span id="cb46-342"><a href="#cb46-342"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Score <span class="kw">DESC</span></span>
<span id="cb46-343"><a href="#cb46-343"></a><span class="in">```</span></span>
<span id="cb46-344"><a href="#cb46-344"></a></span>
<span id="cb46-345"><a href="#cb46-345"></a></span>
<span id="cb46-346"><a href="#cb46-346"></a><span class="fu">### SQL Summarization </span></span>
<span id="cb46-347"><a href="#cb46-347"></a></span>
<span id="cb46-348"><a href="#cb46-348"></a>So far, we have covered the equivalent of R's selecting, filtering, and arranging. </span>
<span id="cb46-349"><a href="#cb46-349"></a></span>
<span id="cb46-350"><a href="#cb46-350"></a>Let's take a look at grouping and summarizing now, which has similar structures in both <span class="in">`R`</span> and SQL. Imagine we want to see how many posts of each type there are. This query shows us that there are 44K questions and 71K answers.</span>
<span id="cb46-351"><a href="#cb46-351"></a></span>
<span id="cb46-352"><a href="#cb46-352"></a><span class="in">```{sql eval=FALSE}</span></span>
<span id="cb46-353"><a href="#cb46-353"></a><span class="kw">SELECT</span> </span>
<span id="cb46-354"><a href="#cb46-354"></a>PostTypeId, <span class="fu">COUNT</span>(Id) numPosts</span>
<span id="cb46-355"><a href="#cb46-355"></a><span class="kw">FROM</span> posts</span>
<span id="cb46-356"><a href="#cb46-356"></a><span class="kw">GROUP</span> <span class="kw">BY</span> PostTypeId </span>
<span id="cb46-357"><a href="#cb46-357"></a><span class="kw">ORDER</span> <span class="kw">BY</span> PostTypeId</span>
<span id="cb46-358"><a href="#cb46-358"></a><span class="in">```</span></span>
<span id="cb46-359"><a href="#cb46-359"></a></span>
<span id="cb46-360"><a href="#cb46-360"></a>Note two characteristics of SQL summarization here:</span>
<span id="cb46-361"><a href="#cb46-361"></a></span>
<span id="cb46-362"><a href="#cb46-362"></a><span class="ss">- </span>The <span class="in">`GROUP BY`</span>clause indicates the table column for grouping, much like R's <span class="in">`group_by`</span>.</span>
<span id="cb46-363"><a href="#cb46-363"></a><span class="ss">- </span>There is no explicit <span class="in">`summarize`</span>. Instead, all columns that appear in the SELECT except for those listed in <span class="in">`GROUP BY`</span> must make use of an aggregate function. <span class="in">`COUNT(*)`</span> is one of these, and is the equivalent of R's <span class="in">`n()`</span>. Many other <span class="co">[</span><span class="ot">aggregate functions</span><span class="co">](https://docs.microsoft.com/en-us/sql/t-sql/functions/aggregate-functions-transact-sql)</span> exist, including <span class="in">`MAX`</span>, <span class="in">`SUM`</span>, <span class="in">`AVG`</span>, and many others. Every aggregate function requires a column as an argument (even <span class="in">`COUNT()`</span> which doesn't logically need one).</span>
<span id="cb46-364"><a href="#cb46-364"></a><span class="ss">- </span>The aggregate column (in this case <span class="in">`COUNT(Id)`</span>) must immediately be followed by a name that will be used for it in the results (in this case <span class="in">`numPosts`</span>). This can be particularly useful if you want to order by the aggregated value.</span>
<span id="cb46-365"><a href="#cb46-365"></a></span>
<span id="cb46-366"><a href="#cb46-366"></a>**Exercise:** Change the previous query so it orders the result rows by the number of posts of that type. *Hint: Reuse the name you assigned to the aggregate function.*</span>
<span id="cb46-367"><a href="#cb46-367"></a></span>
<span id="cb46-368"><a href="#cb46-368"></a><span class="in">```{sql eval=FALSE}</span></span>
<span id="cb46-369"><a href="#cb46-369"></a><span class="kw">SELECT</span> </span>
<span id="cb46-370"><a href="#cb46-370"></a>PostTypeId, <span class="fu">COUNT</span>(Id) numPosts</span>
<span id="cb46-371"><a href="#cb46-371"></a><span class="kw">FROM</span> posts</span>
<span id="cb46-372"><a href="#cb46-372"></a><span class="kw">GROUP</span> <span class="kw">BY</span> PostTypeId </span>
<span id="cb46-373"><a href="#cb46-373"></a><span class="kw">ORDER</span> <span class="kw">BY</span> numPosts</span>
<span id="cb46-374"><a href="#cb46-374"></a><span class="in">```</span></span>
<span id="cb46-375"><a href="#cb46-375"></a></span>
<span id="cb46-376"><a href="#cb46-376"></a></span>
<span id="cb46-377"><a href="#cb46-377"></a>**Exercise:** Find the most commonly used tagsets (sets/combinations of tags) applied to posts. Note that this is not asking you to count the most common individual tags --- this would be more complex because multiple tags are squashed into the Tags field.</span>
<span id="cb46-378"><a href="#cb46-378"></a></span>
<span id="cb46-379"><a href="#cb46-379"></a></span>
<span id="cb46-380"><a href="#cb46-380"></a><span class="in">```{sql eval=FALSE}</span></span>
<span id="cb46-381"><a href="#cb46-381"></a><span class="kw">SELECT</span> </span>
<span id="cb46-382"><a href="#cb46-382"></a>Tags, <span class="fu">COUNT</span>(Tags) numTags</span>
<span id="cb46-383"><a href="#cb46-383"></a><span class="kw">FROM</span> posts</span>
<span id="cb46-384"><a href="#cb46-384"></a><span class="kw">GROUP</span> <span class="kw">BY</span> Tags </span>
<span id="cb46-385"><a href="#cb46-385"></a><span class="kw">ORDER</span> <span class="kw">BY</span> numTags</span>
<span id="cb46-386"><a href="#cb46-386"></a><span class="in">```</span></span>
<span id="cb46-387"><a href="#cb46-387"></a></span>
<span id="cb46-388"><a href="#cb46-388"></a></span>
<span id="cb46-389"><a href="#cb46-389"></a><span class="fu">### SQL Joins </span></span>
<span id="cb46-390"><a href="#cb46-390"></a></span>
<span id="cb46-391"><a href="#cb46-391"></a>Finally, as with <span class="in">`R`</span>, we often want to join data from two or more tables. The types of joins in SQL are the same as we saw with R (inner, outer, left, right). Most commonly we want to perform an INNER join, which is the default if you just say <span class="in">`JOIN`</span>. (We can look up the <span class="in">`inner_join()`</span> documentation to remind ourselves what an inner join does.)</span>
<span id="cb46-392"><a href="#cb46-392"></a></span>
<span id="cb46-393"><a href="#cb46-393"></a>Let's say we wanted to enhance the earlier query to find the highest scoring answers with some information about each user. </span>
<span id="cb46-394"><a href="#cb46-394"></a></span>
<span id="cb46-395"><a href="#cb46-395"></a><span class="in">```{sql eval=FALSE}</span></span>
<span id="cb46-396"><a href="#cb46-396"></a><span class="kw">SELECT</span> TOP(<span class="dv">100</span>)</span>
<span id="cb46-397"><a href="#cb46-397"></a>Title, Score, DisplayName, Reputation</span>
<span id="cb46-398"><a href="#cb46-398"></a><span class="kw">FROM</span> Posts p</span>
<span id="cb46-399"><a href="#cb46-399"></a><span class="kw">JOIN</span> Users u</span>
<span id="cb46-400"><a href="#cb46-400"></a><span class="kw">ON</span> p<span class="ch">.</span>OwnerUserId <span class="op">=</span> u<span class="ch">.</span>Id</span>
<span id="cb46-401"><a href="#cb46-401"></a><span class="kw">WHERE</span> PostTypeId <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb46-402"><a href="#cb46-402"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Score <span class="kw">Desc</span></span>
<span id="cb46-403"><a href="#cb46-403"></a><span class="in">```</span></span>
<span id="cb46-404"><a href="#cb46-404"></a></span>
<span id="cb46-405"><a href="#cb46-405"></a>We see a few notable items here:</span>
<span id="cb46-406"><a href="#cb46-406"></a></span>
<span id="cb46-407"><a href="#cb46-407"></a><span class="ss">- </span>The <span class="in">`JOIN`</span> keyword must go in between the two tables we want to join.</span>
<span id="cb46-408"><a href="#cb46-408"></a><span class="ss">- </span>Each table must be named. In this case we named posts <span class="in">`p`</span> and users <span class="in">`u`</span>.</span>
<span id="cb46-409"><a href="#cb46-409"></a><span class="ss">- </span>We need to specify the relationship that joins the two tables. In this case, a posts <span class="in">`OwnerUserId`</span> column refers to the <span class="in">`Id`</span> column in the users table.</span>
<span id="cb46-410"><a href="#cb46-410"></a></span>
<span id="cb46-411"><a href="#cb46-411"></a>**Exercise:** Create a query similar to the one above that identifies the authors of the top rated comments instead of posts.</span>
<span id="cb46-412"><a href="#cb46-412"></a></span>
<span id="cb46-413"><a href="#cb46-413"></a><span class="in">```{sql eval=FALSE}</span></span>
<span id="cb46-414"><a href="#cb46-414"></a><span class="kw">SELECT</span> TOP(<span class="dv">100</span>)</span>
<span id="cb46-415"><a href="#cb46-415"></a><span class="dt">Text</span>, Score, DisplayName, Reputation, AboutMe, Views, UpVotes, DownVotes</span>
<span id="cb46-416"><a href="#cb46-416"></a><span class="kw">FROM</span> Comments c</span>
<span id="cb46-417"><a href="#cb46-417"></a><span class="kw">JOIN</span> Users u</span>
<span id="cb46-418"><a href="#cb46-418"></a><span class="kw">ON</span> c<span class="ch">.</span>UserId <span class="op">=</span> u<span class="ch">.</span>Id</span>
<span id="cb46-419"><a href="#cb46-419"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Score <span class="kw">Desc</span></span>
<span id="cb46-420"><a href="#cb46-420"></a><span class="in">```</span></span>
<span id="cb46-421"><a href="#cb46-421"></a></span>
<span id="cb46-422"><a href="#cb46-422"></a></span>
<span id="cb46-423"><a href="#cb46-423"></a>If you want more practice, go to <span class="ot">&lt;https://mystery.knightlab.com/&gt;</span>.</span>
<span id="cb46-424"><a href="#cb46-424"></a></span>
<span id="cb46-425"><a href="#cb46-425"></a><span class="fu">## Going Beyond</span></span>
<span id="cb46-426"><a href="#cb46-426"></a></span>
<span id="cb46-427"><a href="#cb46-427"></a><span class="fu">### Exploring cloud DBMS's</span></span>
<span id="cb46-428"><a href="#cb46-428"></a></span>
<span id="cb46-429"><a href="#cb46-429"></a><span class="co">[</span><span class="ot">Redshift</span><span class="co">](https://aws.amazon.com/redshift/)</span> is Amazon's cloud database management system (DBMS).</span>
<span id="cb46-430"><a href="#cb46-430"></a></span>
<span id="cb46-431"><a href="#cb46-431"></a><span class="ss">- </span>To try out Redshift, you can sign up for a free <span class="co">[</span><span class="ot">AWS Educate</span><span class="co">](https://aws.amazon.com/education/awseducate/)</span> account. Once your account is confirmed, you will have access to many tutorials about cloud computing.</span>
<span id="cb46-432"><a href="#cb46-432"></a><span class="ss">- </span>In the Getting Started section of your <span class="co">[</span><span class="ot">AWS Educate main page</span><span class="co">](https://www.awseducate.com/student/s/)</span>, navigate to the <span class="co">[</span><span class="ot">Getting Started with Databases (Lab)</span><span class="co">](https://awseducate.instructure.com/courses/912)</span> tutorial on the second page of tutorials.</span>
<span id="cb46-433"><a href="#cb46-433"></a><span class="ss">- </span>Various Redshift resources can be found <span class="co">[</span><span class="ot">here</span><span class="co">](https://aws.amazon.com/redshift/getting-started/)</span>.</span>
<span id="cb46-434"><a href="#cb46-434"></a></span>
<span id="cb46-435"><a href="#cb46-435"></a></span>
<span id="cb46-436"><a href="#cb46-436"></a><span class="co">[</span><span class="ot">BigQuery</span><span class="co">](https://cloud.google.com/bigquery/)</span> is Google's DBMS.</span>
<span id="cb46-437"><a href="#cb46-437"></a></span>
<span id="cb46-438"><a href="#cb46-438"></a><span class="ss">- </span>BigQuery can be tried for free through <span class="co">[</span><span class="ot">Big Query sandbox</span><span class="co">](https://cloud.google.com/blog/products/data-analytics/query-without-a-credit-card-introducing-bigquery-sandbox)</span>.</span>
<span id="cb46-439"><a href="#cb46-439"></a><span class="ss">- </span>On the <span class="co">[</span><span class="ot">main BigQuery page</span><span class="co">](https://cloud.google.com/bigquery/)</span> you'll see a big blue button that says "Try BigQuery free".</span>
<span id="cb46-440"><a href="#cb46-440"></a><span class="ss">- </span>On the cloud welcome page under the Products section, you'll see a button for "Analyze and manage data - BigQuery".</span>
<span id="cb46-441"><a href="#cb46-441"></a><span class="ss">- </span>Accessing public data within BigQuery</span>
<span id="cb46-442"><a href="#cb46-442"></a><span class="ss">    - </span>In your "Welcome to BigQuery Studio!" window, you'll see a "Try the Google Trends Demo Query" section.</span>
<span id="cb46-443"><a href="#cb46-443"></a><span class="ss">    - </span>Click the "Open this query" blue button to get an example SQL statement for the Google Trends dataset. You'll also see on the left panel a list of all public datasets available through BigQuery.</span>
<span id="cb46-444"><a href="#cb46-444"></a><span class="fu">## Done!</span></span>
<span id="cb46-445"><a href="#cb46-445"></a></span>
<span id="cb46-446"><a href="#cb46-446"></a><span class="ss">- </span>Check the ICA Instructions for how to (a) push your code to GitHub and (b) update your portfolio website</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>